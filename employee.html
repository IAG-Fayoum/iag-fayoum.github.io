<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f766e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    
    <title>Ù…Ù‡Ø§Ù…ÙŠ | Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</title>
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f3f4f6; font-size: 14px; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        :root {
            --primary: #0f766e;
            --c-new: #3b82f6; --c-pending: #16a34a; --c-approved: #047857;   
            --c-followup: #6b7280; --c-late: #dc2626;       
        }

        /* --- Header --- */
        .main-header {
            background: #115e59;
            color: white; padding: 1rem 1.5rem 3.5rem;
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            box-shadow: 0 4px 15px rgba(15, 118, 110, 0.2);
            position: relative; z-index: 10;
            padding-top: max(1rem, env(safe-area-inset-top));
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .header-btn { padding: 8px; color: white; border-radius: 50%; transition: 0.2s; display: flex; align-items: center; justify-content: center;}
        .header-btn:hover { background: rgba(255,255,255,0.2); }
        .breadcrumbs { display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.75rem; color: #ccfbf1; margin-bottom: 6px; opacity: 0.9; }
        .breadcrumbs span { opacity: 0.7; }
        .breadcrumbs strong { font-weight: 700; color: white; }
        .dept-title { font-size: 1rem; font-weight: 800; line-height: 1.2; text-align: center; }
        .dept-subtitle { font-size: 0.75rem; opacity: 0.8; font-weight: 600; text-align: center; direction: ltr; margin-top: 2px; font-family: sans-serif; }

        /* --- Employee Info Card --- */
        .emp-card {
            margin: -2.5rem 1rem 1rem; position: relative; z-index: 20;
            background: white; border-radius: 16px; padding: 1rem 1.25rem;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;
            display: flex; align-items: center; gap: 14px;
        }
        @media (min-width: 1024px) { .emp-card { max-width: 1200px; margin: -2.5rem auto 1rem; } }
        .emp-avatar { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        .emp-info { flex: 1; min-width: 0; }
        .emp-name { font-size: 1rem; font-weight: 800; color: #0f172a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .emp-title { font-size: 0.8rem; font-weight: 700; }
        .emp-meta { font-size: 0.7rem; color: #94a3b8; font-weight: 600; margin-top: 2px; display: flex; gap: 12px; flex-wrap: wrap; }

        /* --- Filters --- */
        .filter-container { margin: 0 1rem 1rem; position: relative; background: white; border-radius: 16px; padding: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.04); border: 1px solid #e2e8f0; }
        .filter-grid { display: flex; flex-direction: column; gap: 10px; }
        @media (min-width: 1024px) { .filter-container { max-width: 1200px; margin: 0 auto 1rem; } .filter-grid { flex-direction: row; align-items: flex-end; } .filter-item-search { flex: 2; } .filter-item { flex: 1; } }
        .f-label { font-size: 0.7rem; font-weight: 700; color: #64748b; margin-bottom: 4px; display: block; }
        .f-input { width: 100%; height: 40px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 0.85rem; outline: none; background: #fff; color: #1e293b; transition: 0.2s; padding: 0 8px; }
        .f-input:focus { border-color: #0f766e; box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1); }
        .search-wrapper { position: relative; }
        .search-input { padding-right: 12px; padding-left: 36px; background-color: #f8fafc; }
        .search-icon { position: absolute; left: 10px; top: 10px; width: 18px; height: 18px; color: #94a3b8; pointer-events: none; }

        /* --- Stats --- */
        .stats-wrapper { padding: 0 1rem 1rem; max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 8px; }
        .stats-row-big { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .stats-row-small { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .stat-card-big { background: white; border: 2px solid #e5e7eb; border-radius: 14px; padding: 10px; text-align: center; cursor: pointer; height: 82px; display: flex; flex-direction: column; justify-content: center; transition: 0.2s; }
        .stat-card-big.active { background: #f0fdfa; border-color: var(--primary); }
        .stat-card-big .num { font-size: 1.8rem; font-weight: 800; line-height: 1; margin-bottom: 2px; }
        .stat-card-big .lbl { font-size: 0.8rem; font-weight: 700; color: #64748b; }
        .stat-card-small { background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 6px; text-align: center; cursor: pointer; min-height: 65px; display: flex; flex-direction: column; justify-content: center; transition: 0.2s; }
        .stat-card-small.active { background: #f0fdfa; border-color: var(--primary); }
        .stat-card-small .num { font-size: 1.3rem; font-weight: 800; line-height: 1; }
        .stat-card-small .lbl { font-size: 0.6rem; font-weight: 700; color: #64748b; }
        .txt-total { color: #334155; } .txt-late { color: #dc2626; } .txt-new { color: #3b82f6; } .txt-pending { color: #16a34a; } .txt-approved { color: #047857; } .txt-followup { color: #6b7280; }

        /* --- Tabs --- */
        .main-tabs { display: flex; gap: 0; padding: 0 1rem; max-width: 1200px; margin: 0 auto 12px; border-bottom: 1px solid #e2e8f0; overflow-x: auto; }
        .tab-btn { padding: 10px 14px; font-weight: 700; color: #64748b; border-bottom: 3px solid transparent; cursor: pointer; transition: 0.3s; white-space: nowrap; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-badge { background: #e2e8f0; color: #64748b; font-size: 0.6rem; font-weight: 800; padding: 1px 6px; border-radius: 10px; }
        .tab-btn.active .tab-badge { background: #ccfbf1; color: var(--primary); }

        .sub-tabs { display: flex; gap: 8px; padding: 8px; background: #e2e8f0; border-radius: 10px; margin-bottom: 12px; }
        .sub-tab { flex: 1; text-align: center; padding: 8px; border-radius: 8px; font-size: 0.8rem; font-weight: 700; color: #64748b; cursor: pointer; transition: 0.2s; }
        .sub-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* --- Cards --- */
        .cards-container { padding: 0 1rem 5rem; display: grid; gap: 12px; max-width: 1200px; margin: 0 auto; grid-template-columns: 1fr; }
        @media (min-width: 768px) { .cards-container { grid-template-columns: repeat(2, 1fr); } }

        .task-card { background: white; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.04); border: 1px solid #e5e7eb; display: flex; flex-direction: column; }
        .card-stripe { padding: 7px 12px; color: white; font-weight: 700; font-size: 0.7rem; display: flex; justify-content: space-between; align-items: center; }
        .stripe-right { display: flex; align-items: center; gap: 6px; }
        .stripe-type { background: rgba(255,255,255,0.25); padding: 1px 8px; border-radius: 5px; font-size: 0.65rem; }
        .stripe-dot { width: 6px; height: 6px; border-radius: 50%; background: white; opacity: 0.8; }
        
        .bg-new { background: #3b82f6; } .bg-pending { background: #16a34a; } .bg-approved { background: #047857; } .bg-followup { background: #6b7280; } .bg-late { background: #dc2626; }
        .bg-incoming { background: #2563eb; } .bg-outgoing { background: #0f766e; } .bg-complaint { background: #7c3aed; }
        .bg-tech { background: #2563eb; } .bg-fin { background: #16a34a; }

        .card-body { padding: 12px 14px; flex: 1; display: flex; flex-direction: column; gap: 6px; }
        .tc-subject { font-size: 0.9rem; font-weight: 800; color: #1e293b; line-height: 1.5; border-right: 3px solid #0f766e; padding-right: 8px; }
        .tc-row { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; color: #475569; }
        .tc-icon-box { width: 22px; height: 22px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; }

        /* Badges */
        .badge { display: inline-flex; align-items: center; gap: 3px; padding: 2px 8px; border-radius: 20px; font-size: 0.6rem; font-weight: 700; }
        .badge-imp-urgent2 { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .badge-imp-urgent { background: #fff7ed; color: #ea580c; border: 1px solid #fed7aa; }
        .badge-imp-normal { background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; }
        .badge-type { background: #f8fafc; color: #475569; border: 1px solid #e2e8f0; }
        .badge-case { background: #faf5ff; color: #7c3aed; border: 1px solid #e9d5ff; }
        .badge-delay { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; animation: pulse 2s infinite; }
        .badge-done { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }
        .badges-row { display: flex; flex-wrap: wrap; gap: 4px; padding-top: 8px; border-top: 1px solid #f1f5f9; margin-top: 4px; }

        .tc-notes { padding: 5px 8px; border-radius: 6px; background: #fffbeb; border: 1px solid #fde68a; font-size: 0.7rem; color: #92400e; font-weight: 600; line-height: 1.5; }

        /* Footer buttons */
        .tc-footer { padding: 8px 12px; background: #fafbfc; border-top: 1px solid #f1f5f9; display: flex; flex-wrap: wrap; gap: 5px; margin-top: auto; }
        .btn-card { padding: 6px 8px; border-radius: 7px; font-size: 0.7rem; font-weight: 700; display: inline-flex; align-items: center; gap: 3px; cursor: pointer; border: 1px solid; text-decoration: none; transition: 0.15s; }
        .btn-details { background: #334155; color: white; border-color: #334155; }
        .btn-att-in { color: #0369a1; border-color: #bae6fd; background: #f0f9ff; }
        .btn-att-out { color: #0f766e; border-color: #99f6e4; background: #f0fdfa; }
        .btn-doc { color: #2563eb; border-color: #bfdbfe; background: #eff6ff; }
        .btn-report { color: #7c3aed; border-color: #ddd6fe; background: #faf5ff; }
        .btn-pdf { color: #dc2626; border-color: #fecaca; background: #fef2f2; }
        .btn-archive { color: #047857; border-color: #a7f3d0; background: #ecfdf5; }

        /* Report Card */
        .report-card { background: white; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.04); border: 1px solid #e5e7eb; border-right: 4px solid #e5e7eb; }
        .report-card.rc-tech { border-right-color: #3b82f6; }
        .report-card.rc-fin { border-right-color: #16a34a; }
        .report-card.rc-complaint { border-right-color: #7c3aed; }

        /* --- Side Menu, Modal, Nav --- */
        .side-menu { position: fixed; top: 0; right: -260px; width: 260px; height: 100%; background: white; z-index: 100; transition: 0.3s; display: flex; flex-direction: column; box-shadow: -5px 0 25px rgba(0,0,0,0.1); }
        .side-menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 99; opacity: 0; pointer-events: none; transition: 0.3s; }
        .menu-open .side-menu { right: 0; } .menu-open .side-menu-overlay { opacity: 1; pointer-events: auto; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
        .modal-box { background: white; width: 95%; max-width: 600px; max-height: 90vh; border-radius: 16px; overflow-y: auto; display: flex; flex-direction: column; }
        .modal-header { padding: 1rem 1.25rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: #f8fafc; }
        .modal-body { padding: 1.25rem; }
        .data-item { border-bottom: 1px solid #f1f5f9; padding-bottom: 6px; margin-bottom: 6px; }
        .data-label { font-size: 0.7rem; color: #64748b; font-weight: 700; }
        .data-val { font-size: 0.9rem; color: #0f172a; font-weight: 600; }
        .modal-links { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; padding-top: 10px; border-top: 1px solid #e5e7eb; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-around; padding: 8px 0; z-index: 90; padding-bottom: max(8px, env(safe-area-inset-bottom)); }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #94a3b8; text-decoration: none; font-size: 0.65rem; font-weight: 600; width: 60px; }
        .nav-btn.active { color: var(--primary); }

        .loader-box { grid-column: 1 / -1; text-align: center; padding: 3rem; color: #94a3b8; }
        .empty-box { grid-column: 1 / -1; text-align: center; padding: 3rem; color: #64748b; border: 1px dashed #e2e8f0; border-radius: 12px; background: white; }
        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
    </style>
</head>
<body>

    <!-- Side Menu -->
    <div class="side-menu-overlay" onclick="toggleMenu()"></div>
    <aside class="side-menu">
        <div class="p-6 bg-teal-50 border-b border-teal-100 text-center">
            <div class="w-16 h-16 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-3">
                <i data-lucide="user" class="w-8 h-8 text-teal-700"></i>
            </div>
            <h3 class="font-bold text-teal-900 text-sm" id="menu-user">...</h3>
            <p class="text-xs text-teal-600" id="menu-role">...</p>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="employee.html" class="flex items-center gap-3 p-3 rounded-lg bg-teal-600 text-white font-bold text-sm"><i data-lucide="list-todo" class="w-4 h-4"></i> Ù…Ù‡Ø§Ù…ÙŠ</a>
            <a href="distribution.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="bar-chart-2" class="w-4 h-4"></i> Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a>
            <a href="forms.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="file-text" class="w-4 h-4"></i> Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
            <a href="notifications.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="bell" class="w-4 h-4"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
        </nav>
        <div class="p-4 border-t">
            <button onclick="logout()" class="w-full flex items-center justify-center gap-2 p-3 text-red-600 font-bold hover:bg-red-50 rounded-lg text-sm">
                <i data-lucide="log-out" class="w-5 h-5"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </aside>

    <!-- Header -->
    <header class="main-header">
        <div class="max-w-[1200px] mx-auto">
            <div class="header-top">
                <button onclick="toggleMenu()" class="header-btn"><i data-lucide="menu" class="w-6 h-6"></i></button>
                <div class="text-center">
                    <div class="breadcrumbs"><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span><i data-lucide="chevron-left" class="w-3 h-3 text-teal-200"></i><strong>ØµÙØ­ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©</strong></div>
                    <h1 class="dept-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</h1>
                    <p class="dept-subtitle">Internal Audit & Governance Dept</p>
                </div>
                <button onclick="window.location.href='notifications.html'" class="header-btn relative">
                    <i data-lucide="bell" class="w-6 h-6"></i>
                    <span class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-teal-700"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Employee Card -->
    <div class="emp-card" id="emp-card">
        <div class="emp-avatar" id="emp-avatar">ğŸ‘¤</div>
        <div class="emp-info">
            <div class="emp-name" id="emp-name">...</div>
            <div class="emp-title" id="emp-title">...</div>
            <div class="emp-meta">
                <span id="emp-email">...</span>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats-wrapper">
        <div class="stats-row-big">
            <div class="stat-card-big active" onclick="filterStatus('')" id="st-total"><span class="num txt-total" id="c-total">0</span><span class="lbl">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span></div>
            <div class="stat-card-big" onclick="filterStatus('Ù…ØªØ£Ø®Ø±')" id="st-late"><span class="num txt-late" id="c-late">0</span><span class="lbl">Ù…ØªØ£Ø®Ø±</span></div>
        </div>
        <div class="stats-row-small">
            <div class="stat-card-small" onclick="filterStatus('Ø¬Ø¯ÙŠØ¯')" id="st-new"><span class="num txt-new" id="c-new">0</span><span class="lbl">Ø¬Ø¯ÙŠØ¯</span></div>
            <div class="stat-card-small" onclick="filterStatus('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')" id="st-pending"><span class="num txt-pending" id="c-pending">0</span><span class="lbl">Ø¨Ø§Ù†ØªØ¸Ø§Ø±</span></div>
            <div class="stat-card-small" onclick="filterStatus('ØªÙ…')" id="st-approved"><span class="num txt-approved" id="c-approved">0</span><span class="lbl">Ù…Ø¹ØªÙ…Ø¯</span></div>
            <div class="stat-card-small" onclick="filterStatus('Ù…ØªØ§Ø¨Ø¹Ø©')" id="st-followup"><span class="num txt-followup" id="c-followup">0</span><span class="lbl">Ù…ØªØ§Ø¨Ø¹Ø©</span></div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="main-tabs" id="main-tabs">
        <div onclick="switchTab('tasks')" id="tab-tasks" class="tab-btn active"><i data-lucide="list-checks" class="w-4 h-4"></i> Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª <span class="tab-badge" id="badge-tasks">0</span></div>
        <div onclick="switchTab('reports')" id="tab-reports" class="tab-btn"><i data-lucide="file-check" class="w-4 h-4"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± <span class="tab-badge" id="badge-reports">0</span></div>
    </div>

    <!-- Sub Tabs (Reports) -->
    <div id="sub-tabs-box" class="hidden px-4 mb-3" style="max-width:1200px;margin-left:auto;margin-right:auto;">
        <div class="sub-tabs">
            <div onclick="switchSubTab('inspection')" id="sub-inspection" class="sub-tab active">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙˆØ±</div>
            <div onclick="switchSubTab('complaint')" id="sub-complaint" class="sub-tab">ÙØ­Øµ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filter-container">
        <div class="filter-grid">
            <div class="filter-item-search">
                <label class="f-label">Ø¨Ø­Ø« Ø´Ø§Ù…Ù„</label>
                <div class="search-wrapper">
                    <input type="text" id="f-search" class="f-input search-input" placeholder="Ø±Ù‚Ù…ØŒ Ù…ÙˆØ¶ÙˆØ¹ØŒ Ø¬Ù‡Ø©..." oninput="applyFilters()">
                    <i data-lucide="search" class="search-icon"></i>
                </div>
            </div>
            <div class="filter-item">
                <label class="f-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                <input type="date" id="f-start" class="f-input px-2" onchange="applyFilters()">
            </div>
            <div class="filter-item">
                <label class="f-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                <input type="date" id="f-end" class="f-input px-2" onchange="applyFilters()">
            </div>
        </div>
    </div>

    <!-- Cards -->
    <div class="cards-container" id="cards-list">
        <div class="loader-box"><i data-lucide="loader-2" class="w-8 h-8 animate-spin mx-auto mb-2 text-teal-600"></i><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p></div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detail-modal">
        <div class="modal-box">
            <div class="modal-header">
                <div><h3 class="font-bold text-lg text-gray-900">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</h3><p class="text-xs text-gray-500 font-mono" id="m-id">#...</p></div>
                <button onclick="closeModal()" class="p-2 bg-gray-100 rounded-full hover:bg-red-50 hover:text-red-500"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="modal-body"><div id="m-content"></div></div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="bottom-nav lg:hidden">
        <a href="employee.html" class="nav-btn active"><i data-lucide="list-todo"></i> Ù…Ù‡Ø§Ù…ÙŠ</a>
        <a href="distribution.html" class="nav-btn"><i data-lucide="bar-chart-2"></i> Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a>
        <a href="forms.html" class="nav-btn"><i data-lucide="file-text"></i> Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
        <a href="notifications.html" class="nav-btn"><i data-lucide="bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
    </nav>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        lucide.createIcons();

        let allTasks = [], allReports = [];
        let currentStatusFilter = '', currentTab = 'tasks', currentSubTab = 'inspection';
        let currentUser = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', async () => {
            const userStr = localStorage.getItem('iag_user');
            if (!userStr) { window.location.href = 'index.html'; return; }
            
            currentUser = JSON.parse(userStr);
            document.getElementById('menu-user').textContent = currentUser.name;
            document.getElementById('menu-role').textContent = currentUser.role;

            // Employee card
            const jt = (currentUser.jobTitle || '').trim();
            const isTech = jt.includes('ÙÙ†ÙŠ');
            document.getElementById('emp-name').textContent = currentUser.name;
            document.getElementById('emp-title').textContent = jt || currentUser.role;
            document.getElementById('emp-title').style.color = isTech ? '#2563eb' : '#16a34a';
            document.getElementById('emp-email').textContent = currentUser.email || '';
            document.getElementById('emp-avatar').textContent = isTech ? 'ğŸ”¬' : 'ğŸ’°';
            document.getElementById('emp-avatar').style.background = isTech ? '#eff6ff' : '#f0fdf4';

            // Sub-tab label
            document.getElementById('sub-inspection').textContent = isTech ? 'Ù…Ø±ÙˆØ± ÙÙ†ÙŠ' : 'Ù…Ø±ÙˆØ± Ù…Ø§Ù„ÙŠ ÙˆØ¥Ø¯Ø§Ø±ÙŠ';

            // Default date = current month
            const now = new Date();
            const y = now.getFullYear(), m = String(now.getMonth()+1).padStart(2,'0');
            document.getElementById('f-start').value = y+'-'+m+'-01';
            document.getElementById('f-end').value = y+'-'+m+'-'+new Date(y, now.getMonth()+1, 0).getDate();

            await loadData(currentUser.name);
        });

        function toggleMenu() { document.body.classList.toggle('menu-open'); }
        function logout() { localStorage.removeItem('iag_user'); localStorage.removeItem('iag_last_page'); window.location.href = 'index.html'; }
        function closeModal() { document.getElementById('detail-modal').classList.remove('open'); }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATA LOADING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadData(username) {
            try {
                const res = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getAllData', role: 'Ù…ÙˆØ¸Ù', name: username })
                });
                const data = await res.json();
                if (data.success) {
                    allTasks = data.tasks || [];
                    allReports = data.reports || [];
                    updateBadges();
                    applyFilters();
                } else {
                    document.getElementById('cards-list').innerHTML = '<div class="empty-box">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>';
                }
            } catch (e) {
                document.getElementById('cards-list').innerHTML = '<div class="empty-box text-red-500"><i data-lucide="wifi-off" class="w-8 h-8 mx-auto mb-2"></i>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
                lucide.createIcons();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATS & BADGES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateStats(tasks) {
            let c = { total:0, new:0, pending:0, approved:0, followup:0, late:0 };
            tasks.forEach(t => {
                c.total++;
                const s = (t.status||'');
                if(s.includes('Ù…ØªØ£Ø®Ø±')) c.late++;
                else if(s.includes('Ø¬Ø¯ÙŠØ¯')) c.new++;
                else if(s.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')) c.pending++;
                else if(s.includes('ØªÙ…') || s.includes('Ø£Ø±Ø´ÙŠÙ')) c.approved++;
                else if(s.includes('Ù…ØªØ§Ø¨Ø¹Ø©')) c.followup++;
            });
            document.getElementById('c-total').textContent = c.total;
            document.getElementById('c-new').textContent = c.new;
            document.getElementById('c-pending').textContent = c.pending;
            document.getElementById('c-approved').textContent = c.approved;
            document.getElementById('c-followup').textContent = c.followup;
            document.getElementById('c-late').textContent = c.late;
        }

        function updateBadges() {
            document.getElementById('badge-tasks').textContent = allTasks.length;
            document.getElementById('badge-reports').textContent = allReports.length;
        }

        function filterStatus(status) {
            currentStatusFilter = status;
            document.querySelectorAll('.stat-card-big, .stat-card-small').forEach(el => el.classList.remove('active'));
            const map = {'':'st-total','Ø¬Ø¯ÙŠØ¯':'st-new','Ø¨Ø§Ù†ØªØ¸Ø§Ø±':'st-pending','ØªÙ…':'st-approved','Ù…ØªØ§Ø¨Ø¹Ø©':'st-followup','Ù…ØªØ£Ø®Ø±':'st-late'};
            let id = 'st-total';
            if(status) { const k = Object.keys(map).find(k => status.includes(k)); if(k) id = map[k]; }
            document.getElementById(id).classList.add('active');
            applyFilters();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TABS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active');
            document.getElementById('sub-tabs-box').classList.toggle('hidden', tab !== 'reports');
            applyFilters();
        }
        function switchSubTab(sub) {
            currentSubTab = sub;
            document.querySelectorAll('.sub-tab').forEach(b => b.classList.remove('active'));
            document.getElementById('sub-'+sub).classList.add('active');
            applyFilters();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATE HELPERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function parseDate(str) {
            if(!str) return null;
            const p = str.split('/');
            return p.length===3 ? new Date(p[2], p[1]-1, p[0]) : null;
        }
        function inRange(dateStr, s, e) {
            if(!s && !e) return true;
            const d = parseDate(dateStr);
            if(!d) return false;
            if(s && d < new Date(s)) return false;
            if(e && d > new Date(e+'T23:59:59')) return false;
            return true;
        }
        function fmtDate(str) {
            if(!str) return '-';
            const p = str.split('/');
            if(p.length!==3) return str;
            return new Date(p[2],p[1]-1,p[0]).toLocaleDateString('ar-EG',{day:'numeric',month:'short',year:'numeric'});
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FILTERS & RENDER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function applyFilters() {
            const container = document.getElementById('cards-list');
            const search = document.getElementById('f-search').value.toLowerCase();
            const start = document.getElementById('f-start').value;
            const end = document.getElementById('f-end').value;

            if (currentTab === 'tasks') {
                let filtered = allTasks.filter(t => {
                    if(currentStatusFilter && !(t.status||'').includes(currentStatusFilter)) return false;
                    if(search && !(t.subject+t.id+t.source+t.entity).toLowerCase().includes(search)) return false;
                    if(!inRange(t.date, start, end)) return false;
                    return true;
                });
                updateStats(filtered);
                if(filtered.length === 0) { container.innerHTML = '<div class="empty-box">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>'; return; }
                renderTasks(filtered, container);
            } else {
                let filtered = allReports.filter(r => {
                    const rt = (r.type||'').toLowerCase();
                    if(currentSubTab === 'inspection') {
                        if(!rt.includes('Ù…Ø±ÙˆØ±') && !rt.includes('ÙÙ†ÙŠ') && !rt.includes('Ù…Ø§Ù„ÙŠ')) return false;
                    } else {
                        if(!rt.includes('Ø´ÙƒÙˆ') && !rt.includes('Ø´ÙƒØ§') && !rt.includes('ÙØ­Øµ')) return false;
                    }
                    if(search && !(r.title+r.entity+r.type).toLowerCase().includes(search)) return false;
                    if(!inRange(r.date, start, end)) return false;
                    return true;
                });
                if(filtered.length === 0) { container.innerHTML = '<div class="empty-box">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ±</div>'; return; }
                renderReports(filtered, container);
            }
            lucide.createIcons();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDER TASKS (Professional Cards)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderTasks(tasks, container) {
            container.innerHTML = tasks.map(t => {
                const s = t.status || '';
                // Status stripe color
                let bgClass = 'bg-new';
                if(s.includes('Ù…ØªØ£Ø®Ø±')) bgClass = 'bg-late';
                else if(s.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')) bgClass = 'bg-pending';
                else if(s.includes('ØªÙ…') || s.includes('Ø£Ø±Ø´ÙŠÙ')) bgClass = 'bg-approved';
                else if(s.includes('Ø¬Ø§Ø±ÙŠ') || s.includes('Ù‚ÙŠØ¯')) bgClass = 'bg-followup';
                else if(s.includes('Ù…ØªØ§Ø¨Ø¹Ø©')) bgClass = 'bg-followup';

                // Status label
                let stLabel = 'Ø¬Ø¯ÙŠØ¯';
                if(s.includes('Ù…ØªØ£Ø®Ø±')) stLabel = 'Ù…ØªØ£Ø®Ø±';
                else if(s.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')) stLabel = 'Ø¨Ø§Ù†ØªØ¸Ø§Ø±';
                else if(s.includes('ØªÙ…') || s.includes('Ø£Ø±Ø´ÙŠÙ')) stLabel = 'Ù…Ø¹ØªÙ…Ø¯';
                else if(s.includes('Ø¬Ø§Ø±ÙŠ') || s.includes('Ù‚ÙŠØ¯')) stLabel = 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°';
                else if(s.includes('Ù…ØªØ§Ø¨Ø¹Ø©')) stLabel = 'Ù…ØªØ§Ø¨Ø¹Ø©';

                // Type detection
                const isComplaint = (t.transactionType||'').includes('Ø´Ùƒ');
                const isOutgoing = t.docType === 'ØµØ§Ø¯Ø±';
                const typeLabel = isComplaint ? 'Ø´ÙƒÙˆÙ‰' : isOutgoing ? 'ØµØ§Ø¯Ø±' : 'ÙˆØ§Ø±Ø¯';
                const typeIcon = isComplaint ? 'âš–ï¸' : isOutgoing ? 'ğŸ“¤' : 'ğŸ“¥';

                // Subject border color
                const subjectBorder = isComplaint ? '#7c3aed' : isOutgoing ? '#0f766e' : '#2563eb';

                // Importance badge
                let impBadge = '';
                if(t.importance) {
                    const cls = t.importance === 'Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹' ? 'badge-imp-urgent2' : t.importance === 'Ø¹Ø§Ø¬Ù„' ? 'badge-imp-urgent' : 'badge-imp-normal';
                    const ico = t.importance === 'Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹' ? 'ğŸ”´' : t.importance === 'Ø¹Ø§Ø¬Ù„' ? 'ğŸŸ ' : 'ğŸŸ¢';
                    impBadge = '<span class="badge '+cls+'">'+ico+' '+t.importance+'</span>';
                }

                // Other badges
                let typeBadge = '<span class="badge badge-type">ğŸ“ '+(t.transactionType||t.docType||'')+'</span>';
                let caseBadge = (t.caseNumber && t.caseNumber!=='') ? '<span class="badge badge-case">ğŸ“ '+t.caseNumber+'/'+(t.caseYear||'')+'</span>' : '';
                let delayBadge = t.delay ? '<span class="badge badge-delay">âš ï¸ Ù…ØªØ£Ø®Ø± '+t.delay+' ÙŠÙˆÙ…</span>' : '';
                let doneBadge = t.completionDate ? '<span class="badge badge-done">âœ… Ø£ÙÙ†Ø¬Ø² '+t.completionDate+'</span>' : '';

                // Notes
                let notesHtml = (t.notes && t.notes.trim()) ? '<div class="tc-notes">ğŸ’¡ '+t.notes+'</div>' : '';

                // Buttons - differentiated icons
                let btns = '<button onclick="openModal(\''+t.id+'\')" class="btn-card btn-details"><i data-lucide="eye" class="w-3.5 h-3.5"></i> Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>';
                
                // Ù…Ø±ÙÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯
                if(t.attachment && !isOutgoing) btns += '<a href="'+t.attachment+'" target="_blank" class="btn-card btn-att-in"><i data-lucide="inbox" class="w-3.5 h-3.5"></i> Ù…Ø±ÙÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯</a>';
                // Ù…Ø±ÙÙ‚ Ø§Ù„ØµØ§Ø¯Ø±
                if(t.attachment && isOutgoing) btns += '<a href="'+t.attachment+'" target="_blank" class="btn-card btn-att-out"><i data-lucide="send" class="w-3.5 h-3.5"></i> Ù…Ø±ÙÙ‚ Ø§Ù„ØµØ§Ø¯Ø±</a>';
                // Ø§Ù„Ø£Ø±Ø´ÙŠÙ (Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯)
                if(t.archive) btns += '<a href="'+t.archive+'" target="_blank" class="btn-card btn-archive"><i data-lucide="archive" class="w-3.5 h-3.5"></i> Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</a>';
                // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙˆØ± / ÙØ­Øµ Ø§Ù„Ø´ÙƒÙˆÙ‰ (Google Doc)
                if(t.report) {
                    if(isComplaint) {
                        btns += '<a href="'+t.report+'" target="_blank" class="btn-card btn-report"><i data-lucide="scale" class="w-3.5 h-3.5"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ</a>';
                    } else {
                        btns += '<a href="'+t.report+'" target="_blank" class="btn-card btn-doc"><i data-lucide="file-text" class="w-3.5 h-3.5"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙˆØ±</a>';
                    }
                }

                return `
                <div class="task-card">
                    <div class="card-stripe ${bgClass}">
                        <div class="stripe-right">
                            <span>${typeIcon}</span>
                            <span class="stripe-type">${typeLabel}</span>
                            <span style="font-family:monospace;font-size:0.75rem">#${t.id}</span>
                        </div>
                        <div class="stripe-right">
                            <span class="stripe-dot"></span>
                            <span>${stLabel}</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <h3 class="tc-subject" style="border-right-color:${subjectBorder}">${t.subject}</h3>
                        <div class="tc-row">
                            <span class="tc-icon-box" style="background:#f0fdfa"><i data-lucide="building-2" class="w-3 h-3 text-teal-600"></i></span>
                            ${t.source || '-'}
                        </div>
                        ${t.entity && t.entity !== t.source ? '<div class="tc-row"><span class="tc-icon-box" style="background:#f1f5f9"><i data-lucide="map-pin" class="w-3 h-3 text-gray-500"></i></span>'+t.entity+'</div>' : ''}
                        <div class="tc-row" style="gap:12px">
                            <span style="display:flex;align-items:center;gap:3px"><i data-lucide="calendar" class="w-3 h-3 text-gray-400"></i> ${fmtDate(t.date)}</span>
                            ${t.deadline ? '<span style="display:flex;align-items:center;gap:3px;color:'+(s.includes('Ù…ØªØ£Ø®Ø±')?'#dc2626':'#ea580c')+';font-weight:700"><i data-lucide="clock" class="w-3 h-3"></i> '+fmtDate(t.deadline)+'</span>' : ''}
                        </div>
                        <div class="badges-row">
                            ${impBadge}${typeBadge}${caseBadge}${delayBadge}${doneBadge}
                        </div>
                        ${notesHtml}
                    </div>
                    <div class="tc-footer">${btns}</div>
                </div>`;
            }).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDER REPORTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderReports(reports, container) {
            container.innerHTML = reports.map(r => {
                const rt = (r.type||'').toLowerCase();
                let rcClass = 'rc-tech', icon = 'ğŸ”¬', accent = '#2563eb';
                if(rt.includes('Ù…Ø§Ù„ÙŠ')) { rcClass = 'rc-fin'; icon = 'ğŸ’°'; accent = '#16a34a'; }
                if(rt.includes('Ø´Ùƒ') || rt.includes('ÙØ­Øµ')) { rcClass = 'rc-complaint'; icon = 'âš–ï¸'; accent = '#7c3aed'; }

                let btns = '';
                if(r.docLink) {
                    const docLabel = (rt.includes('Ø´Ùƒ') || rt.includes('ÙØ­Øµ')) ? 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ' : 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙˆØ±';
                    const docIcon = (rt.includes('Ø´Ùƒ') || rt.includes('ÙØ­Øµ')) ? 'scale' : 'file-text';
                    btns += '<a href="'+r.docLink+'" target="_blank" class="btn-card btn-doc"><i data-lucide="'+docIcon+'" class="w-3.5 h-3.5"></i> '+docLabel+'</a>';
                }
                if(r.pdfLink) btns += '<a href="'+r.pdfLink+'" target="_blank" class="btn-card btn-pdf"><i data-lucide="file-check" class="w-3.5 h-3.5"></i> PDF Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</a>';

                return `
                <div class="report-card ${rcClass}">
                    <div style="padding:12px 14px">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
                            <div style="display:flex;align-items:center;gap:8px">
                                <span style="width:34px;height:34px;border-radius:8px;background:${accent}10;display:flex;align-items:center;justify-content:center;font-size:18px">${icon}</span>
                                <div>
                                    <div style="font-size:0.85rem;font-weight:800;color:${accent}">${r.type}</div>
                                    <div style="font-size:0.65rem;color:#94a3b8;font-weight:600">${fmtDate(r.date)}</div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size:0.85rem;font-weight:700;color:#1e293b;margin-bottom:4px;display:flex;align-items:center;gap:5px">
                            <i data-lucide="map-pin" class="w-3 h-3 text-teal-600"></i> ${r.entity}
                        </div>
                    </div>
                    <div class="tc-footer">${btns}</div>
                </div>`;
            }).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DETAIL MODAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function openModal(id) {
            const t = allTasks.find(x => x.id == id);
            if(!t) return;
            document.getElementById('m-id').textContent = '#' + t.id;

            const isComplaint = (t.transactionType||'').includes('Ø´Ùƒ');
            const isOutgoing = t.docType === 'ØµØ§Ø¯Ø±';

            // Importance color
            let impHtml = t.importance || '-';
            if(t.importance === 'Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹') impHtml = '<span style="color:#dc2626;font-weight:800">ğŸ”´ '+t.importance+'</span>';
            else if(t.importance === 'Ø¹Ø§Ø¬Ù„') impHtml = '<span style="color:#ea580c;font-weight:800">ğŸŸ  '+t.importance+'</span>';
            else if(t.importance) impHtml = '<span style="color:#16a34a;font-weight:800">ğŸŸ¢ '+t.importance+'</span>';

            let html = `
                <div class="data-item"><span class="data-label">Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯</span><p class="data-val">${t.id}</p></div>
                <div class="data-item"><span class="data-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</span><p class="data-val">${t.docType || '-'}</p></div>
                <div class="data-item"><span class="data-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</span><p class="data-val">${fmtDate(t.date)}</p></div>
                <div class="data-item"><span class="data-label">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</span><p class="data-val" style="font-weight:800;line-height:1.6">${t.subject}</p></div>
                <div class="data-item"><span class="data-label">${isOutgoing ? 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„ÙŠÙ‡Ø§' : 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ÙˆØ§Ø±Ø¯Ø©'}</span><p class="data-val">${t.source}</p></div>
                <div class="data-item"><span class="data-label">Ù…Ø­Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°</span><p class="data-val">${t.entity}</p></div>
                <div class="data-item"><span class="data-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</span><p class="data-val">${t.transactionType || '-'}</p></div>
                ${t.caseNumber ? '<div class="data-item"><span class="data-label">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</span><p class="data-val">'+t.caseNumber+' / '+(t.caseYear||'')+'</p></div>' : ''}
                <div class="data-item"><span class="data-label">Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</span><p class="data-val">${impHtml}</p></div>
                <div class="data-item"><span class="data-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙƒÙ„ÙŠÙ</span><p class="data-val">${fmtDate(t.assignDate)}</p></div>
                <div class="data-item"><span class="data-label">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><p class="data-val" style="color:${t.status&&t.status.includes('Ù…ØªØ£Ø®Ø±')?'#dc2626':'#ea580c'};font-weight:800">${fmtDate(t.deadline) || '-'}</p></div>
                <div class="data-item"><span class="data-label">Ø§Ù„Ø­Ø§Ù„Ø©</span><p class="data-val" style="color:var(--primary)">${t.status}</p></div>
                <div class="data-item"><span class="data-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span><p class="data-val">${t.completionDate ? fmtDate(t.completionDate) : '-'}</p></div>
                ${t.delay ? '<div class="data-item"><span class="data-label" style="color:#dc2626">Ø£ÙŠØ§Ù… Ø§Ù„ØªØ£Ø®ÙŠØ±</span><p class="data-val" style="color:#dc2626;font-weight:800">'+t.delay+' ÙŠÙˆÙ…</p></div>' : ''}
                ${t.notes && t.notes.trim() ? '<div class="bg-yellow-50 p-2 rounded-lg text-sm border border-yellow-200 mt-2"><span class="data-label text-yellow-700">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span><p class="data-val text-gray-700">'+t.notes+'</p></div>' : ''}
            `;

            // Links
            let links = '';
            if(t.attachment && !isOutgoing) links += '<a href="'+t.attachment+'" target="_blank" class="btn-card btn-att-in"><i data-lucide="inbox" class="w-3.5 h-3.5"></i> Ù…Ø±ÙÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯</a>';
            if(t.attachment && isOutgoing) links += '<a href="'+t.attachment+'" target="_blank" class="btn-card btn-att-out"><i data-lucide="send" class="w-3.5 h-3.5"></i> Ù…Ø±ÙÙ‚ Ø§Ù„ØµØ§Ø¯Ø±</a>';
            if(t.archive) links += '<a href="'+t.archive+'" target="_blank" class="btn-card btn-archive"><i data-lucide="archive" class="w-3.5 h-3.5"></i> Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</a>';
            if(t.report && isComplaint) links += '<a href="'+t.report+'" target="_blank" class="btn-card btn-report"><i data-lucide="scale" class="w-3.5 h-3.5"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ</a>';
            else if(t.report) links += '<a href="'+t.report+'" target="_blank" class="btn-card btn-doc"><i data-lucide="file-text" class="w-3.5 h-3.5"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙˆØ±</a>';

            if(links) html += '<div class="modal-links">'+links+'</div>';

            document.getElementById('m-content').innerHTML = html;
            document.getElementById('detail-modal').classList.add('open');
            lucide.createIcons();
        }
    </script>
</body>
</html>
