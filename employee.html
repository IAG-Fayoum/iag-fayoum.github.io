<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Ù…Ù‡Ø§Ù…ÙŠ | Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</title>
    
    <link rel="icon" href="assets/icons/favicon.png">
    <link rel="apple-touch-icon" href="assets/icons/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        :root { --primary: #0f766e; --bg: #f8fafc; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); padding-bottom: 80px; }
        .task-card { background: white; border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 16px; position: relative; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .status-line { width: 5px; height: 100%; position: absolute; right: 0; top: 0; }
        .st-new { border-right: 5px solid #0ea5e9; } .st-done { border-right: 5px solid #10b981; } .st-late { border-right: 5px solid #ef4444; }
        @media(min-width:1024px){ body{padding-right:260px} .mobile-nav{display:none} .sidebar{transform:translateX(0)!important} }
    </style>
</head>
<body>

    <aside class="sidebar fixed top-0 right-0 h-full bg-white w-64 shadow-lg border-l transition-transform translate-x-full lg:translate-x-0 z-50 flex flex-col">
        <div class="p-6 border-b flex items-center gap-3">
            <div class="bg-teal-50 p-2 rounded text-[#0f766e]"><i data-lucide="shield-check"></i></div>
            <div><h1 class="font-bold text-lg">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h1><p class="text-xs text-gray-500">Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¸Ù</p></div>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="distribution.html" class="flex gap-3 px-4 py-3 text-gray-600 hover:bg-teal-50 rounded-xl"><i data-lucide="layout-grid"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="employee.html" class="flex gap-3 px-4 py-3 bg-[#0f766e] text-white rounded-xl font-bold shadow"><i data-lucide="briefcase"></i> Ù…Ù‡Ø§Ù…ÙŠ</a>
            <a href="forms.html" class="flex gap-3 px-4 py-3 text-gray-600 hover:bg-teal-50 rounded-xl"><i data-lucide="file-text"></i> Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
        </nav>
        <div class="p-4 border-t"><button onclick="auth.logout()" class="flex items-center gap-2 text-red-500 font-bold text-sm"><i data-lucide="log-out" class="w-4"></i> Ø®Ø±ÙˆØ¬</button></div>
    </aside>

    <main class="p-4 lg:p-8 max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-6 lg:hidden">
            <h1 class="font-bold text-lg text-[#0f766e]">Ù…Ù‡Ø§Ù…ÙŠ</h1>
            <button onclick="location.reload()" class="p-2 bg-white rounded shadow-sm"><i data-lucide="refresh-cw" class="w-5"></i></button>
        </div>

        <div class="mb-6">
            <h2 class="text-xl font-bold">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ <span id="user-name" class="text-[#0f766e]">...</span> ğŸ‘‹</h2>
            <p class="text-sm text-gray-500">Ø¥Ù„ÙŠÙƒ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒÙ„Ù Ø¨Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
        </div>

        <div class="flex gap-2 overflow-x-auto pb-2 mb-4">
            <button onclick="filter('all')" class="px-4 py-2 bg-[#0f766e] text-white rounded-lg text-xs font-bold whitespace-nowrap">Ø§Ù„ÙƒÙ„</button>
            <button onclick="filter('new')" class="px-4 py-2 bg-white border text-gray-600 rounded-lg text-xs font-bold whitespace-nowrap">Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„</button>
            <button onclick="filter('late')" class="px-4 py-2 bg-white border text-red-600 rounded-lg text-xs font-bold whitespace-nowrap">Ù…ØªØ£Ø®Ø±</button>
        </div>

        <div id="tasks-list" class="space-y-4">
            <div class="text-center py-12"><i data-lucide="loader-2" class="w-8 h-8 animate-spin text-[#0f766e] mx-auto"></i></div>
        </div>
    </main>

    <nav class="mobile-nav fixed bottom-0 w-full bg-white border-t flex justify-around p-3 z-40 shadow-lg">
        <a href="distribution.html" class="flex flex-col items-center text-gray-400 text-[10px]"><i data-lucide="layout-grid" class="w-6"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="employee.html" class="flex flex-col items-center text-[#0f766e] font-bold text-[10px]"><i data-lucide="briefcase" class="w-6"></i>Ù…Ù‡Ø§Ù…ÙŠ</a>
        <a href="forms.html" class="flex flex-col items-center text-gray-400 text-[10px]"><i data-lucide="file-text" class="w-6"></i>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
    </nav>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        lucide.createIcons();
        let myTasks = [];

        document.addEventListener('DOMContentLoaded', async () => {
            const user = auth.checkAuth();
            if(!user) return;
            document.getElementById('user-name').textContent = user.name;

            const startDate = `${new Date().getFullYear()}-01-01`; // Turbo Mode
            try {
                const res = await auth.callAPI('getAllData', { role: 'employee', name: user.name, startDate });
                if(res.success) {
                    myTasks = res.tasks.filter(t => t.assignee.includes(user.name));
                    renderTasks(myTasks);
                }
            } catch(e) { console.error(e); }
        });

        function filter(type) {
            let filtered = myTasks;
            if(type === 'new') filtered = myTasks.filter(t => !t.status.includes('ØªÙ…') && !t.status.includes('Ù…Ù†ØªÙ‡ÙŠ'));
            if(type === 'late') filtered = myTasks.filter(t => t.status.includes('Ù…ØªØ£Ø®Ø±'));
            renderTasks(filtered);
        }

        function renderTasks(tasks) {
            const container = document.getElementById('tasks-list');
            if(!tasks.length) return container.innerHTML = '<div class="text-center py-10 text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</div>';

            container.innerHTML = tasks.map(t => {
                const isLate = t.status.includes('Ù…ØªØ£Ø®Ø±');
                const isDone = t.status.includes('ØªÙ…') || t.status.includes('Ù…Ù†ØªÙ‡ÙŠ');
                const statusClass = isLate ? 'st-late' : (isDone ? 'st-done' : 'st-new');
                
                return `
                <div class="task-card">
                    <div class="status-line ${statusClass}"></div>
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] bg-gray-100 px-2 py-1 rounded text-gray-600 font-bold">#${t.id}</span>
                            <span class="text-[10px] font-bold ${isLate ? 'text-red-600' : 'text-gray-500'}">${t.status}</span>
                        </div>
                        <h3 class="font-bold text-gray-800 mb-3 text-sm">${t.subject}</h3>
                        ${t.caseNumber ? `<div class="text-xs bg-orange-50 text-orange-800 p-2 rounded mb-2 font-bold">âš–ï¸ Ù‚Ø¶ÙŠØ©: ${t.caseNumber}</div>` : ''}
                        <div class="flex gap-3 text-xs text-gray-500">
                            <span>ğŸ“¥ ${t.source}</span>
                            <span>ğŸ“… ${t.deadline || t.date}</span>
                        </div>
                    </div>
                    <div class="p-3 border-t bg-gray-50 flex gap-2">
                        ${t.attachment ? `<a href="${t.attachment}" target="_blank" class="flex-1 text-center py-2 bg-white border rounded text-xs font-bold text-[#0f766e]">Ù…Ø¹Ø§ÙŠÙ†Ø©</a>` : ''}
                        <button onclick="window.open('${CONFIG.FORMS.INBOX}', '_blank')" class="flex-1 text-center py-2 bg-[#0f766e] text-white rounded text-xs font-bold shadow">ØªØ³Ø¬ÙŠÙ„ Ø±Ø¯</button>
                    </div>
                </div>`;
            }).join('');
            lucide.createIcons();
        }
    </script>
</body>
</html>
