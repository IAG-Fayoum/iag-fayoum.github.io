<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</title>
    
    <link rel="icon" href="assets/icons/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; color: #1e293b; padding-bottom: 80px; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Sidebar Styling (Desktop) */
        @media (min-width: 1024px) {
            body { padding-bottom: 0; padding-right: 260px; }
            .sidebar { transform: translateX(0) !important; width: 260px; }
            .bottom-nav { display: none !important; }
            .mobile-header { display: none !important; }
        }

        /* Tabs Styling */
        .tab-btn {
            padding: 12px 20px;
            border-bottom: 3px solid transparent;
            font-weight: 700;
            color: #64748b;
            transition: all 0.3s;
            cursor: pointer;
        }
        .tab-btn.active {
            color: #0f766e;
            border-bottom-color: #0f766e;
            background-color: #f0fdfa;
        }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Admin Action Cards */
        .task-card {
            background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px;
            transition: all 0.2s; position: relative;
        }
        .task-card:hover { border-color: #0f766e; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }

        /* Inputs */
        .input-field {
            width: 100%; padding: 10px 14px; border: 1px solid #cbd5e1; border-radius: 8px;
            outline: none; transition: 0.2s; font-size: 0.9rem;
        }
        .input-field:focus { border-color: #0f766e; box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1); }

        /* Status Badges */
        .st-new { background: #e0f2fe; color: #0284c7; }
        .st-progress { background: #fef9c3; color: #ca8a04; }
        .st-done { background: #dcfce7; color: #16a34a; }
        .st-late { background: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>

    <aside class="sidebar fixed top-0 right-0 h-full bg-white border-l border-slate-200 z-50 transition-transform duration-300 translate-x-full flex flex-col shadow-lg">
        <div class="p-6 border-b border-slate-100 flex items-center gap-3 bg-[#0f766e] text-white">
            <div class="bg-white/20 p-2 rounded-lg">
                <i data-lucide="shield-check" class="w-6 h-6"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-tight">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h1>
                <p class="text-[10px] text-teal-100 opacity-90">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</p>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto p-4 space-y-2">
            <a href="distribution.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-medium transition-colors">
                <i data-lucide="layout-grid" class="w-5 h-5"></i>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            
            <a href="employee.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-medium transition-colors">
                <i data-lucide="briefcase" class="w-5 h-5"></i>
                <span>Ù…Ù‡Ø§Ù…ÙŠ</span>
            </a>

            <a href="forms.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-medium transition-colors">
                <i data-lucide="file-text" class="w-5 h-5"></i>
                <span>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</span>
            </a>

            <div class="pt-4 mt-2 border-t border-slate-100">
                <p class="px-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
                <a href="admin.html" class="flex items-center gap-3 px-4 py-3 bg-teal-50 text-teal-700 rounded-xl font-bold transition-colors shadow-sm">
                    <i data-lucide="settings-2" class="w-5 h-5"></i>
                    <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </a>
                <a href="coordinator.html" class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-medium transition-colors">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙƒÙ„ÙŠÙ</span>
                </a>
            </div>
        </nav>

        <div class="p-4 border-t border-slate-100 bg-slate-50">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 overflow-hidden">
                    <div class="w-9 h-9 rounded-full bg-[#0f766e] text-white flex items-center justify-center font-bold text-sm" id="user-avatar"></div>
                    <div class="min-w-0">
                        <p class="text-sm font-bold text-slate-800 truncate" id="user-name">...</p>
                        <p class="text-xs text-slate-500 truncate" id="user-role">...</p>
                    </div>
                </div>
                <button onclick="auth.logout()" class="text-slate-400 hover:text-red-500 transition-colors p-1"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
        </div>
    </aside>

    <main class="min-h-screen w-full">
        <div class="mobile-header bg-white p-4 sticky top-0 z-30 border-b border-slate-200 flex items-center justify-between lg:hidden shadow-sm">
            <h1 class="font-bold text-lg text-teal-800">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
            <div class="w-8"></div>
        </div>

        <div class="p-4 lg:p-8 max-w-7xl mx-auto space-y-6">
            
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex overflow-x-auto hide-scrollbar">
                <button onclick="switchTab('reassign')" class="tab-btn active flex-1 whitespace-nowrap flex items-center justify-center gap-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙ
                </button>
                <button onclick="switchTab('new-task')" class="tab-btn flex-1 whitespace-nowrap flex items-center justify-center gap-2">
                    <i data-lucide="plus-circle" class="w-4 h-4"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
                </button>
                <button onclick="switchTab('monitor')" class="tab-btn flex-1 whitespace-nowrap flex items-center justify-center gap-2">
                    <i data-lucide="bar-chart-3" class="w-4 h-4"></i> Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©
                </button>
            </div>

            <div id="tab-reassign" class="tab-content active space-y-6">
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label class="text-xs font-bold text-slate-500 mb-1 block">ÙÙ„ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <select id="filter-emp-reassign" onchange="applyReassignFilter()" class="input-field">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="text-xs font-bold text-slate-500 mb-1 block">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                        <select id="filter-status-reassign" onchange="applyReassignFilter()" class="input-field">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Ø¬Ø§Ø±ÙŠ">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="Ù…ØªØ£Ø®Ø±">Ù…ØªØ£Ø®Ø±</option>
                        </select>
                    </div>
                </div>

                <div id="reassign-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="col-span-full text-center py-10 text-slate-400">
                        <span class="animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
                    </div>
                </div>
            </div>

            <div id="tab-new-task" class="tab-content">
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm max-w-3xl mx-auto">
                    <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2 border-b border-slate-100 pb-4">
                        <i data-lucide="file-plus" class="w-5 h-5 text-teal-600"></i>
                        Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    </h3>
                    
                    <form id="new-task-form" onsubmit="handleAddTask(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>
                                <select id="nt-type" class="input-field bg-slate-50">
                                    <option value="ØµØ§Ø¯Ø±">ğŸ“¤ ØµØ§Ø¯Ø±</option>
                                    <option value="ÙˆØ§Ø±Ø¯">ğŸ“¥ ÙˆØ§Ø±Ø¯</option>
                                    <option value="Ø¯Ø§Ø®Ù„ÙŠ">ğŸ”„ Ø¯Ø§Ø®Ù„ÙŠ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</label>
                                <input type="date" id="nt-date" class="input-field" required>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-1">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
                            <input type="text" id="nt-subject" placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ø§Ø®ØªØµØ§Ø±..." class="input-field" required>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1">Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„Ù…ØµØ¯Ø±</label>
                                <input type="text" id="nt-entity" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙˆØ²Ø§Ø±Ø©ØŒ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©..." class="input-field" required>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1">Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙƒÙ„Ù</label>
                                <select id="nt-assignee" class="input-field" required>
                                    <option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù...</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                                <select id="nt-priority" class="input-field">
                                    <option value="Ø¹Ø§Ø¯ÙŠ">ğŸ”µ Ø¹Ø§Ø¯ÙŠ</option>
                                    <option value="Ù…Ù‡Ù…">ğŸŸ¡ Ù…Ù‡Ù…</option>
                                    <option value="Ø¹Ø§Ø¬Ù„">ğŸ”´ Ø¹Ø§Ø¬Ù„</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                                <input type="text" id="nt-notes" class="input-field" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ...">
                            </div>
                        </div>

                        <div class="pt-4 flex justify-end">
                            <button type="submit" id="btn-add-task" class="bg-[#0f766e] hover:bg-[#0d5f57] text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform active:scale-95 flex items-center gap-2">
                                <i data-lucide="save" class="w-5 h-5"></i>
                                Ø­ÙØ¸ ÙˆØªÙƒÙ„ÙŠÙ
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="tab-monitor" class="tab-content">
                <div id="monitor-container" class="space-y-6">
                    </div>
            </div>

        </div>
    </main>

    <nav class="bottom-nav fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 flex justify-around p-2 pb-safe z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <a href="distribution.html" class="flex flex-col items-center gap-1 p-2 text-slate-400 hover:text-[#0f766e]">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="employee.html" class="flex flex-col items-center gap-1 p-2 text-slate-400 hover:text-[#0f766e]">
            <i data-lucide="briefcase" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">Ù…Ù‡Ø§Ù…ÙŠ</span>
        </a>
        <a href="forms.html" class="flex flex-col items-center gap-1 p-2 text-slate-400 hover:text-[#0f766e]">
            <i data-lucide="file-text" class="w-6 h-6"></i>
            <span class="text-[10px] font-medium">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</span>
        </a>
        <a href="admin.html" class="flex flex-col items-center gap-1 p-2 text-[#0f766e]">
            <i data-lucide="settings-2" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
        </a>
    </nav>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        lucide.createIcons();
        
        let allTasks = [];
        let employeesList = [];

        // 1. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„ØªØ­Ù‚Ù‚
        document.addEventListener('DOMContentLoaded', async () => {
            const user = auth.checkAuth();
            if(!user) return;
            
            // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
            if (user.role === 'employee') {
                alert('â›” Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø¯Ø±Ø§Ø¡ ÙÙ‚Ø·');
                window.location.href = 'distribution.html';
                return;
            }

            // UI Init
            document.getElementById('user-name').textContent = user.name;
            document.getElementById('user-role').textContent = user.jobTitle || 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…';
            document.getElementById('user-avatar').textContent = user.name.charAt(0);
            document.getElementById('nt-date').valueAsDate = new Date();

            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await loadAdminData(user);
        });

        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function loadAdminData(user) {
            try {
                const res = await auth.callAPI('getAllData', {
                    role: 'admin',
                    name: user.name,
                    startDate: '2024-01-01'
                });

                if(res.success) {
                    allTasks = res.tasks;
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    const empSet = new Set();
                    allTasks.forEach(t => t.assignee ? empSet.add(t.assignee) : null);
                    employeesList = Array.from(empSet).sort();

                    // Ù…Ù„Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                    populateSelects();

                    // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙ)
                    applyReassignFilter();
                }
            } catch(e) {
                console.error(e);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        function populateSelects() {
            const options = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù...</option>' + 
                            employeesList.map(e => `<option value="${e}">${e}</option>`).join('');
            
            // ÙÙ„ØªØ± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙ
            document.getElementById('filter-emp-reassign').innerHTML = '<option value="">Ø§Ù„ÙƒÙ„</option>' + 
                            employeesList.map(e => `<option value="${e}">${e}</option>`).join('');
            
            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©"
            document.getElementById('nt-assignee').innerHTML = options;
        }

        // 3. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tabId) {
            // UI Update
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');

            if(tabId === 'monitor') renderMonitorTab();
        }

        // 4. Ù…Ù†Ø·Ù‚: Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙ
        function applyReassignFilter() {
            const emp = document.getElementById('filter-emp-reassign').value;
            const status = document.getElementById('filter-status-reassign').value;

            let filtered = allTasks;
            if(emp) filtered = filtered.filter(t => t.assignee === emp);
            if(status) filtered = filtered.filter(t => t.status.includes(status));

            renderReassignCards(filtered);
        }

        function renderReassignCards(tasks) {
            const container = document.getElementById('reassign-container');
            
            if(tasks.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-10 text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</div>`;
                return;
            }

            container.innerHTML = tasks.map(t => `
                <div class="task-card group">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-mono text-xs font-bold bg-slate-100 px-2 py-1 rounded text-slate-600">#${t.id}</span>
                        <span class="text-[10px] px-2 py-1 rounded-full font-bold ${getStatusClass(t.status)}">${t.status}</span>
                    </div>
                    <h4 class="font-bold text-slate-800 text-sm mb-2 line-clamp-2">${t.subject}</h4>
                    <div class="text-xs text-slate-500 space-y-1 mb-4">
                        <p>ğŸ‘¤ <strong>Ø§Ù„Ù…ÙƒÙ„Ù:</strong> ${t.assignee}</p>
                        <p>ğŸ“… <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${t.date}</p>
                        <p>ğŸ¢ <strong>Ø§Ù„Ø¬Ù‡Ø©:</strong> ${t.entity}</p>
                    </div>
                    
                    <div class="pt-3 border-t border-slate-100 bg-slate-50 p-2 rounded-lg mt-auto">
                        <label class="block text-[10px] font-bold text-slate-500 mb-1">Ø¥Ø¹Ø§Ø¯Ø© ØªÙƒÙ„ÙŠÙ Ø¥Ù„Ù‰:</label>
                        <div class="flex gap-2">
                            <select id="reassign-sel-${t.id}" class="flex-1 text-xs border border-slate-200 rounded-lg p-1 bg-white focus:border-teal-500 outline-none">
                                <option value="">Ø§Ø®ØªØ±...</option>
                                ${employeesList.map(e => `<option value="${e}">${e}</option>`).join('')}
                            </select>
                            <button onclick="submitReassign('${t.id}')" class="bg-slate-800 hover:bg-slate-900 text-white p-1.5 rounded-lg transition-colors" title="Ø­ÙØ¸">
                                <i data-lucide="check" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        async function submitReassign(taskId) {
            const newEmp = document.getElementById(`reassign-sel-${taskId}`).value;
            if(!newEmp) return alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù');

            if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© #${taskId} Ø¥Ù„Ù‰ ${newEmp}ØŸ`)) return;

            // Call API (Placeholder logic - needs backend support)
            try {
                // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© reassignTask ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… updateStatus ÙƒØ¨Ø¯ÙŠÙ„ Ù…Ø¤Ù‚Øª
                // Ù‡Ù†Ø§ Ø³Ù†ÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© reassignTask ÙÙŠ Backend.gs
                /* Ù„Ùˆ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ Backend.gs:
                   function apiReassignTask(taskId, newEmployee) { ... }
                */
                const res = await auth.callAPI('reassignTask', { taskId, newEmployee: newEmp }); 
                
                // ÙÙŠ Ø­Ø§Ù„ Ù„Ù… Ù†Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ø¨Ø¹Ø¯ØŒ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„ØªØ¬Ø±Ø¨Ø©
                // const res = { success: true }; 

                if(res.success) {
                    alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙƒÙ„ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­');
                    await loadAdminData(auth.currentUser); // Refresh
                } else {
                    alert('Ø®Ø·Ø£: ' + (res.error || 'Ø§Ù„Ø¯Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹'));
                }
            } catch(e) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        // 5. Ù…Ù†Ø·Ù‚: Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
        async function handleAddTask(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-add-task');
            
            const taskData = {
                docType: document.getElementById('nt-type').value,
                date: document.getElementById('nt-date').value,
                subject: document.getElementById('nt-subject').value,
                entity: document.getElementById('nt-entity').value,
                assignee: document.getElementById('nt-assignee').value,
                priority: document.getElementById('nt-priority').value,
                notes: document.getElementById('nt-notes').value
            };

            if(!taskData.assignee) return alert('Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙƒÙ„Ù');

            btn.disabled = true;
            btn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

            try {
                // Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© addTask ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©)
                // ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù… Ù†Ø¶ÙÙ‡Ø§ ØµØ±Ø§Ø­Ø©ØŒ Ù„Ø°Ø§ Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ Backend.gs
                /*
                   function apiAddTask(data) {
                      var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Ø§Ù„ØµØ§Ø¯Ø±_ÙˆØ§Ù„ÙˆØ§Ø±Ø¯");
                      // Logic to append row...
                      return { success: true, id: newId };
                   }
                */
               
                // Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¢Ù†ØŒ Ø³Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø©
                alert('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø¯Ø§Ù„Ø© apiAddTask ÙÙŠ Ù…Ù„Ù Backend.gs Ø£ÙˆÙ„Ø§Ù‹.');
                console.log('Task Data:', taskData);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('new-task-form').reset();
            } catch(e) {
                console.error(e);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i data-lucide="save" class="w-5 h-5"></i> Ø­ÙØ¸ ÙˆØªÙƒÙ„ÙŠÙ';
                lucide.createIcons();
            }
        }

        // 6. Ù…Ù†Ø·Ù‚: Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© (Monitoring)
        function renderMonitorTab() {
            const container = document.getElementById('monitor-container');
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù
            const grouped = {};
            employeesList.forEach(emp => grouped[emp] = []);
            allTasks.forEach(t => {
                if(grouped[t.assignee]) grouped[t.assignee].push(t);
            });

            container.innerHTML = Object.entries(grouped).map(([emp, tasks]) => {
                if(tasks.length === 0) return '';
                const doneCount = tasks.filter(t => t.status.includes('ØªÙ…') || t.status.includes('Ù…Ù†ØªÙ‡ÙŠ')).length;
                const lateCount = tasks.filter(t => t.status.includes('Ù…ØªØ£Ø®Ø±')).length;

                return `
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden mb-4">
                    <div class="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center font-bold text-slate-600">
                                ${emp.charAt(0)}
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800">${emp}</h4>
                                <p class="text-[10px] text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${tasks.length} Ù…Ù‡Ù…Ø©</p>
                            </div>
                        </div>
                        <div class="flex gap-2 text-xs font-bold">
                            <span class="text-green-600 bg-green-50 px-2 py-1 rounded">âœ… ${doneCount}</span>
                            <span class="text-red-600 bg-red-50 px-2 py-1 rounded">âš ï¸ ${lateCount}</span>
                        </div>
                    </div>
                    <div class="p-4 grid gap-2">
                        ${tasks.map(t => `
                            <div class="flex justify-between items-center text-sm border-b border-slate-50 last:border-0 pb-2 last:pb-0">
                                <span class="truncate max-w-[200px] text-slate-600">${t.subject}</span>
                                <span class="badge text-[10px] ${getStatusClass(t.status)} px-2 rounded-full">${t.status}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            }).join('');
        }

        function getStatusClass(status) {
            if (!status) return 'bg-slate-100 text-slate-500';
            if (status.includes('Ø¬Ø¯ÙŠØ¯')) return 'st-new';
            if (status.includes('Ø¬Ø§Ø±ÙŠ') || status.includes('Ù‚ÙŠØ¯')) return 'st-progress';
            if (status.includes('ØªÙ…') || status.includes('Ù…Ù†ØªÙ‡ÙŠ')) return 'st-done';
            if (status.includes('Ù…ØªØ£Ø®Ø±')) return 'st-late';
            return 'bg-slate-100 text-slate-500';
        }
    </script>
</body>
</html>
