<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f766e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | IAG Admin</title>
    
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <style>
        /* --- General Styles --- */
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; font-size: 14px; padding-bottom: 80px; }
        
        :root {
            --primary: #0f766e;
            --secondary: #134e4a;
            /* Status Colors */
            --c-total: #334155; --c-new: #3b82f6; --c-pending: #16a34a;
            --c-approved: #047857; --c-followup: #6b7280; --c-late: #dc2626;
            /* Period Colors */
            --c-today: #7c3aed; --c-week: #d97706; --c-month: #0891b2;
        }

        /* --- Header --- */
        .admin-header {
            background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
            color: white; padding: 1rem 1.5rem 4rem;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
            box-shadow: 0 4px 20px rgba(15, 118, 110, 0.25);
            position: relative; z-index: 10;
            padding-top: max(1rem, env(safe-area-inset-top));
        }
        .page-badge { 
            background: rgba(255,255,255,0.15); padding: 4px 12px; border-radius: 20px; 
            font-size: 0.8rem; font-weight: 700; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.2);
        }

        /* --- Stats Cards (2 Rows) --- */
        .stats-wrapper { 
            margin: -3rem 1rem 1rem; position: relative; z-index: 20;
            display: flex; flex-direction: column; gap: 10px; 
        }
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        @media (max-width: 768px) { .stats-row { grid-template-columns: repeat(2, 1fr); } }

        .stat-card {
            background: white; border-radius: 12px; padding: 10px;
            text-align: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0; min-height: 85px; display: flex; flex-direction: column; justify-content: center;
            transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-2px); }
        .stat-num { font-size: 1.5rem; font-weight: 800; line-height: 1; margin-bottom: 2px; }
        .stat-lbl { font-size: 0.75rem; font-weight: 700; color: #64748b; }

        /* Text Colors */
        .t-total { color: var(--c-total); } .t-new { color: var(--c-new); }
        .t-pending { color: var(--c-pending); } .t-late { color: var(--c-late); }
        .t-today { color: var(--c-today); } .t-week { color: var(--c-week); }
        .t-month { color: var(--c-month); } .t-done { color: var(--c-approved); }

        /* --- Quick Actions --- */
        .actions-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            padding: 0 1rem 1rem;
        }
        @media (max-width: 768px) { .actions-grid { grid-template-columns: repeat(2, 1fr); } }
        
        .action-btn {
            background: white; border: 1px solid #cbd5e1; border-radius: 10px;
            padding: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;
            font-weight: 700; color: #475569; font-size: 0.85rem; cursor: pointer; transition: 0.2s;
        }
        .action-btn:hover { border-color: var(--primary); color: var(--primary); background: #f0fdfa; }
        .btn-primary { background: var(--primary); color: white; border: none; }
        .btn-primary:hover { background: var(--secondary); color: white; }

        /* --- Advanced Filters --- */
        .filters-panel {
            background: white; border-radius: 12px; padding: 1rem; margin: 0 1rem 1rem;
            border: 1px solid #e2e8f0; display: none; /* Hidden by default */
        }
        .filters-panel.active { display: block; animation: slideDown 0.3s ease-out; }
        
        .filter-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; }
        @media (min-width: 1024px) { .filter-grid { grid-template-columns: repeat(4, 1fr); } }
        
        .f-input { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.85rem; }

        /* --- Tabs --- */
        .tabs-nav {
            display: flex; gap: 5px; padding: 0 1rem; margin-bottom: 1rem;
            overflow-x: auto; scrollbar-width: none;
        }
        .tab-link {
            padding: 8px 16px; background: white; border-radius: 8px; font-weight: 700;
            color: #64748b; cursor: pointer; border: 1px solid #e2e8f0; white-space: nowrap;
            transition: 0.2s;
        }
        .tab-link.active { background: var(--primary); color: white; border-color: var(--primary); }
        .tab-content { display: none; padding: 0 1rem 2rem; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }

        /* --- DataTable Styling --- */
        .dataTables_wrapper { direction: rtl; background: white; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; }
        table.dataTable thead th { background-color: #f8fafc; color: #475569; font-size: 0.85rem; }
        table.dataTable tbody td { font-size: 0.85rem; vertical-align: middle; }
        .dt-buttons .dt-button { background: #f1f5f9 !important; border: 1px solid #cbd5e1 !important; border-radius: 6px !important; font-size: 0.8rem !important; }
        .status-badge { padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 700; display: inline-block; }

        /* --- Charts Grid --- */
        .charts-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 1024px) { .charts-grid { grid-template-columns: 1fr 1fr; } .chart-full { grid-column: 1 / -1; } }
        .chart-box { background: white; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; min-height: 300px; }

        /* --- Side Menu & Modal --- */
        .side-menu { position: fixed; top: 0; right: -260px; width: 260px; height: 100%; background: white; z-index: 100; transition: 0.3s; display: flex; flex-direction: column; box-shadow: -5px 0 25px rgba(0,0,0,0.1); }
        .side-menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 99; opacity: 0; pointer-events: none; transition: 0.3s; }
        .menu-open .side-menu { right: 0; } .menu-open .side-menu-overlay { opacity: 1; pointer-events: auto; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
        .modal-box { background: white; width: 95%; max-width: 600px; max-height: 90vh; border-radius: 16px; overflow-y: auto; display: flex; flex-direction: column; }
        .modal-header { padding: 1rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: #f8fafc; }
        .modal-body { padding: 1.5rem; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-around; padding: 8px 0; z-index: 90; padding-bottom: max(8px, env(safe-area-inset-bottom)); }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #94a3b8; text-decoration: none; font-size: 0.65rem; font-weight: 600; width: 60px; }
        .nav-btn.active { color: var(--primary); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="side-menu-overlay" onclick="toggleMenu()" id="menu-overlay"></div>
    <aside class="side-menu" id="side-menu">
        <div class="p-6 bg-teal-50 border-b border-teal-100 text-center">
            <div class="w-16 h-16 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-3">
                <i data-lucide="shield-check" class="w-8 h-8 text-teal-700"></i>
            </div>
            <h3 class="font-bold text-teal-900 text-sm" id="menu-user">Admin</h3>
            <p class="text-xs text-teal-600" id="menu-role">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</p>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="index.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="home" class="w-4 h-4"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="admin.html" class="flex items-center gap-3 p-3 rounded-lg bg-teal-600 text-white font-bold text-sm"><i data-lucide="layout-dashboard" class="w-4 h-4"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            <a href="distribution.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="bar-chart-2" class="w-4 h-4"></i> Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a>
            <a href="coordinator.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="users" class="w-4 h-4"></i> Ø§Ù„Ù…Ù†Ø³Ù‚</a>
            <a href="notifications.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 text-gray-700 font-bold text-sm"><i data-lucide="bell" class="w-4 h-4"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
        </nav>
        <div class="p-4 border-t">
            <button onclick="auth.logout()" class="w-full flex items-center justify-center gap-2 p-3 text-red-600 font-bold hover:bg-red-50 rounded-lg text-sm">
                <i data-lucide="log-out" class="w-4 h-4"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </aside>

    <header class="admin-header">
        <div class="max-w-[1400px] mx-auto flex justify-between items-center">
            <button onclick="toggleMenu()" class="p-2 text-white"><i data-lucide="menu" class="w-6 h-6"></i></button>
            <div class="text-center">
                <h1 class="font-bold text-lg">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h1>
                <span class="page-badge">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</span>
            </div>
            <div class="flex gap-2">
                <button onclick="loadAdminData()" class="p-2 text-white bg-white/20 rounded-full hover:bg-white/30"><i data-lucide="refresh-cw" class="w-5 h-5"></i></button>
                <button onclick="window.location.href='notifications.html'" class="p-2 text-white relative">
                    <i data-lucide="bell" class="w-6 h-6"></i>
                    <span class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-teal-700"></span>
                </button>
            </div>
        </div>
    </header>

    <div class="stats-wrapper max-w-[1400px] mx-auto">
        <div class="stats-row">
            <div class="stat-card"><span class="stat-num t-total" id="st-total">0</span><span class="stat-lbl">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span></div>
            <div class="stat-card"><span class="stat-num t-new" id="st-new">0</span><span class="stat-lbl">Ø¬Ø¯ÙŠØ¯</span></div>
            <div class="stat-card"><span class="stat-num t-pending" id="st-pending">0</span><span class="stat-lbl">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</span></div>
            <div class="stat-card"><span class="stat-num t-late" id="st-late">0</span><span class="stat-lbl">Ù…ØªØ£Ø®Ø±</span></div>
        </div>
        <div class="stats-row">
            <div class="stat-card"><span class="stat-num t-today" id="st-today">0</span><span class="stat-lbl">Ø§Ù„ÙŠÙˆÙ…</span></div>
            <div class="stat-card"><span class="stat-num t-week" id="st-week">0</span><span class="stat-lbl">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span></div>
            <div class="stat-card"><span class="stat-num t-month" id="st-month">0</span><span class="stat-lbl">Ø§Ù„Ø´Ù‡Ø±</span></div>
            <div class="stat-card"><span class="stat-num t-done" id="st-approved">0</span><span class="stat-lbl">ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</span></div>
        </div>
    </div>

    <div class="max-w-[1400px] mx-auto">
        <div class="actions-grid">
            <button onclick="openModal('add')" class="action-btn btn-primary"><i data-lucide="plus-circle" class="w-5 h-5"></i> Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button onclick="openModal('report')" class="action-btn"><i data-lucide="file-bar-chart" class="w-5 h-5"></i> ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„</button>
            <button onclick="openModal('compare')" class="action-btn"><i data-lucide="users" class="w-5 h-5"></i> Ù…Ù‚Ø§Ø±Ù†Ø© Ù…ÙˆØ¸ÙÙŠÙ†</button>
            <button onclick="toggleFilters()" class="action-btn"><i data-lucide="filter" class="w-5 h-5"></i> ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø©</button>
            <button onclick="openModal('remind')" class="action-btn"><i data-lucide="mail" class="w-5 h-5"></i> Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ±Ø§Øª</button>
            <button onclick="openModal('export')" class="action-btn"><i data-lucide="download" class="w-5 h-5"></i> ØªØµØ¯ÙŠØ± Excel</button>
        </div>

        <div id="filters-panel" class="filters-panel">
            <div class="filter-grid">
                <input type="date" id="f-start" class="f-input" placeholder="Ù…Ù† ØªØ§Ø±ÙŠØ®">
                <input type="date" id="f-end" class="f-input" placeholder="Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®">
                <select id="f-emp" class="f-input"><option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option></select>
                <select id="f-source" class="f-input"><option value="">ÙƒÙ„ Ø§Ù„Ø¬Ù‡Ø§Øª</option></select>
                <select id="f-status" class="f-input">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                    <option value="Ù…ØªØ£Ø®Ø±">Ù…ØªØ£Ø®Ø±</option>
                    <option value="ØªÙ…">ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</option>
                </select>
                <select id="f-type" class="f-input">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                    <option value="Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙÙ†ÙŠ">Ù…Ø±ÙˆØ± ÙÙ†ÙŠ</option>
                    <option value="Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§Ù„ÙŠ">Ù…Ø±ÙˆØ± Ù…Ø§Ù„ÙŠ</option>
                    <option value="Ø´ÙƒÙˆÙ‰">Ø´ÙƒÙˆÙ‰</option>
                </select>
            </div>
            <div class="flex gap-2">
                <button onclick="applyFilters()" class="bg-teal-600 text-white px-4 py-2 rounded-lg text-sm font-bold flex-1">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
                <button onclick="resetFilters()" class="bg-gray-200 text-gray-600 px-4 py-2 rounded-lg text-sm font-bold">Ù…Ø³Ø­</button>
            </div>
        </div>
    </div>

    <div class="max-w-[1400px] mx-auto mt-4">
        <div class="tabs-nav">
            <button class="tab-link active" onclick="switchTab('transactions')">ğŸ“‹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</button>
            <button class="tab-link" onclick="switchTab('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="tab-link" onclick="switchTab('employees')">ğŸ‘¥ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
            <button class="tab-link" onclick="switchTab('analytics')">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        </div>

        <div id="tab-transactions" class="tab-content active">
            <table id="tasksTable" class="display responsive nowrap w-full" style="width:100%">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø±Ù‚Ù…</th>
                        <th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                        <th>Ø§Ù„Ø¬Ù‡Ø©</th>
                        <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="tab-reports" class="tab-content">
            <div id="reports-grid" class="stats-row" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));"></div>
        </div>

        <div id="tab-employees" class="tab-content">
            <div id="employees-grid" class="stats-row" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));"></div>
        </div>

        <div id="tab-analytics" class="tab-content">
            <div class="charts-grid">
                <div class="chart-box chart-full"><canvas id="chart1"></canvas></div>
                <div class="chart-box"><canvas id="chart2"></canvas></div>
                <div class="chart-box"><canvas id="chart3"></canvas></div>
                <div class="chart-box chart-full"><canvas id="chart4"></canvas></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="main-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="font-bold text-lg" id="modal-title">...</h3>
                <button onclick="closeModal()" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="modal-body" id="modal-body">
                </div>
        </div>
    </div>

    <template id="tpl-add-task">
        <form id="form-add-task" class="space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div><label class="f-label">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</label><input type="text" name="source" class="f-input" required></div>
                <div><label class="f-label">Ù…Ø­Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°</label><input type="text" name="entity" class="f-input" required></div>
            </div>
            <div><label class="f-label">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label><textarea name="subject" class="f-input h-20" required></textarea></div>
            <div class="grid grid-cols-2 gap-3">
                <div><label class="f-label">Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙƒÙ„Ù</label><select name="employee" class="f-input emp-select" required></select></div>
                <div><label class="f-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                    <select name="type" class="f-input">
                        <option>Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙÙ†ÙŠ</option><option>Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§Ù„ÙŠ</option><option>ÙØ­Øµ Ø´ÙƒÙˆÙ‰</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div><label class="f-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆØ§Ø±Ø¯</label><input type="date" name="date" class="f-input" required></div>
                <div><label class="f-label">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label><input type="date" name="deadline" class="f-input"></div>
            </div>
            <div class="flex items-center gap-2 mt-4 bg-yellow-50 p-3 rounded border border-yellow-200">
                <input type="checkbox" checked class="w-4 h-4">
                <span class="text-xs font-bold text-yellow-800">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ÙˆØ¸Ù ÙˆØ¥ÙŠÙ…ÙŠÙ„ Ø±Ø³Ù…ÙŠ</span>
            </div>
            <button type="submit" class="w-full bg-teal-600 text-white py-3 rounded-lg font-bold mt-4">Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„</button>
        </form>
    </template>

    <nav class="bottom-nav lg:hidden">
        <a href="index.html" class="nav-btn"><i data-lucide="home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="admin.html" class="nav-btn active"><i data-lucide="layout-dashboard"></i> Ø§Ù„ØªØ­ÙƒÙ…</a>
        <a href="coordinator.html" class="nav-btn"><i data-lucide="users"></i> Ø§Ù„Ù…Ù†Ø³Ù‚</a>
        <a href="notifications.html" class="nav-btn"><i data-lucide="bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
    </nav>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>

    <script>
        lucide.createIcons();
        let allData = { tasks: [], employees: [] };
        let dataTable;

        // --- Init ---
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof auth === 'undefined' || !auth.checkAuth()) { window.location.href = 'index.html'; return; }
            const user = auth.checkAuth();
            
            if (user.role !== 'Ù…Ø¯ÙŠØ±' && user.role !== 'Admin') {
                Swal.fire({ icon: 'error', title: 'ØºÙŠØ± Ù…ØµØ±Ø­', text: 'ØµÙØ­Ø© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·' }).then(() => location.href = 'employee.html');
                return;
            }

            document.getElementById('menu-user').textContent = user.name;
            
            initDataTable();
            await loadAdminData();
        });

        function toggleMenu() { document.body.classList.toggle('menu-open'); }
        function toggleFilters() { document.getElementById('filters-panel').classList.toggle('active'); }
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-link').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // --- Data Loading ---
        async function loadAdminData() {
            try {
                const res = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getAllData', role: 'Ù…Ø¯ÙŠØ±', name: 'Admin' })
                });
                const data = await res.json();

                if (data.success) {
                    allData = data;
                    updateStats(data.stats.totals);
                    populateDataTable(data.tasks);
                    populateEmployees(data.stats.employees);
                    renderCharts(data);
                    
                    // Populate Filter Dropdowns
                    const emps = data.stats.employees.map(e => `<option>${e.name}</option>`).join('');
                    document.getElementById('f-emp').innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>' + emps;
                }
            } catch (e) {
                console.error(e);
                Swal.fire('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
            }
        }

        function updateStats(s) {
            document.getElementById('st-total').innerText = s.total;
            document.getElementById('st-new').innerText = s.new;
            document.getElementById('st-pending').innerText = s.pending;
            document.getElementById('st-late').innerText = s.overdue;
            document.getElementById('st-approved').innerText = s.completed;
            // Additional mock logic for daily/weekly stats if not provided by backend
            document.getElementById('st-today').innerText = Math.floor(Math.random() * 5); 
            document.getElementById('st-week').innerText = Math.floor(Math.random() * 15);
            document.getElementById('st-month').innerText = Math.floor(Math.random() * 40);
        }

        // --- DataTable ---
        function initDataTable() {
            dataTable = $('#tasksTable').DataTable({
                responsive: true,
                language: { url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/ar.json' },
                columns: [
                    { data: 'id' },
                    { data: 'subject' },
                    { data: 'source' },
                    { data: 'assignee' },
                    { data: 'status', render: (d) => `<span class="status-badge ${getStatusClass(d)}">${d}</span>` },
                    { data: 'date' },
                    { data: null, render: (d) => `
                        <div class="flex gap-1">
                            <button onclick="openModal('details', '${d.id}')" class="text-blue-600 hover:bg-blue-50 p-1 rounded">ğŸ‘ï¸</button>
                            <button onclick="openModal('edit', '${d.id}')" class="text-green-600 hover:bg-green-50 p-1 rounded">âœï¸</button>
                            <button onclick="deleteTask('${d.id}')" class="text-red-600 hover:bg-red-50 p-1 rounded">ğŸ—‘ï¸</button>
                        </div>
                    `}
                ]
            });
        }

        function populateDataTable(tasks) {
            dataTable.clear().rows.add(tasks).draw();
        }

        // --- Employees Tab ---
        function populateEmployees(employees) {
            const container = document.getElementById('employees-grid');
            container.innerHTML = employees.map(e => `
                <div class="stat-card text-right p-4 relative overflow-hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-gray-800">${e.name}</h4>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded">${e.rate}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                        <div class="bg-teal-600 h-2 rounded-full" style="width: ${e.rate}%"></div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div class="bg-blue-50 p-1 rounded"><strong class="block text-blue-700">${e.total}</strong>Ø§Ù„ÙƒÙ„</div>
                        <div class="bg-green-50 p-1 rounded"><strong class="block text-green-700">${e.completed}</strong>Ù…Ù†Ø¬Ø²</div>
                        <div class="bg-red-50 p-1 rounded"><strong class="block text-red-700">${e.overdue}</strong>Ù…ØªØ£Ø®Ø±</div>
                    </div>
                </div>
            `).join('');
        }

        // --- Charts ---
        function renderCharts(data) {
            // Simplified Charts for Admin
            new Chart(document.getElementById('chart1'), {
                type: 'bar',
                data: {
                    labels: data.stats.employees.slice(0, 5).map(e => e.name.split(' ')[0]),
                    datasets: [{ label: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² %', data: data.stats.employees.slice(0, 5).map(e => e.rate), backgroundColor: '#0f766e' }]
                }
            });
            
            new Chart(document.getElementById('chart2'), {
                type: 'doughnut',
                data: {
                    labels: ['Ù…Ù†Ø¬Ø²', 'Ø¬Ø§Ø±ÙŠ', 'Ù…ØªØ£Ø®Ø±'],
                    datasets: [{ data: [data.stats.totals.completed, data.stats.totals.pending, data.stats.totals.overdue], backgroundColor: ['#059669', '#3b82f6', '#dc2626'] }]
                }
            });
        }

        // --- Modals Logic ---
        function openModal(type, id) {
            const modal = document.getElementById('main-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            modal.classList.add('open');
            
            if (type === 'add') {
                title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©';
                const tpl = document.getElementById('tpl-add-task').content.cloneNode(true);
                body.innerHTML = '';
                body.appendChild(tpl);
                
                // Populate Employee Select
                const select = body.querySelector('.emp-select');
                allData.stats.employees.forEach(e => {
                    const opt = document.createElement('option');
                    opt.value = e.name; opt.textContent = e.name;
                    select.appendChild(opt);
                });
                
                // Form Submit Handler
                body.querySelector('form').onsubmit = async (e) => {
                    e.preventDefault();
                    // Call API to Add Task
                    Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...', didOpen: () => Swal.showLoading() });
                    // ... API Logic Here ...
                    setTimeout(() => {
                        Swal.fire('ØªÙ…!', 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        closeModal();
                    }, 1000);
                };
            }
            // Add other cases (edit, delete, etc.) here
        }

        function closeModal() { document.getElementById('main-modal').classList.remove('open'); }

        function deleteTask(id) {
            Swal.fire({
                title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                text: "Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°ÙÙ‡Ø§'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Call API
                    Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù!', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©.', 'success');
                }
            });
        }

        function getStatusClass(status) {
            if(status.includes('Ø¬Ø¯ÙŠØ¯')) return 'bg-blue-100 text-blue-700';
            if(status.includes('ØªÙ…')) return 'bg-green-100 text-green-700';
            if(status.includes('Ù…ØªØ£Ø®Ø±')) return 'bg-red-100 text-red-700';
            return 'bg-gray-100 text-gray-700';
        }
    </script>
</body>
</html>
