<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª | Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</title>
    
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap');
        * { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: #f8fafc; 
            padding-bottom: 80px;
        }

        /* 1. Sidebar */
        .sidebar {
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            width: 260px;
            background: white;
            border-left: 1px solid #e2e8f0;
            z-index: 50;
            transition: transform 0.3s ease;
            box-shadow: -4px 0 15px rgba(0,0,0,0.05);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            margin: 4px 12px;
            border-radius: 12px;
            color: #64748b;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            text-decoration: none;
        }

        .nav-item:hover { background-color: #f0fdfa; color: #0f766e; }
        
        .nav-item.active {
            background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.25);
        }

        /* 2. Stat Cards (Modern Gradients) */
        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border: 1px solid #f1f5f9;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-4px); }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }

        /* Colors */
        .bg-blue-soft { background: #eff6ff; color: #2563eb; }
        .bg-green-soft { background: #f0fdf4; color: #16a34a; }
        .bg-orange-soft { background: #fff7ed; color: #ea580c; }
        .bg-red-soft { background: #fef2f2; color: #dc2626; }

        /* 3. Progress Bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0f766e, #2dd4bf);
            border-radius: 4px;
            transition: width 1s ease-in-out;
        }

        /* 4. Recent Table */
        .recent-table th { font-size: 0.75rem; color: #94a3b8; font-weight: 700; text-align: right; padding: 12px; }
        .recent-table td { padding: 12px; border-bottom: 1px solid #f8fafc; font-size: 0.85rem; font-weight: 600; color: #334155; }
        .recent-table tr:last-child td { border: none; }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(100%); }
            .main-content { margin-right: 0 !important; }
            .mobile-header { display: flex !important; }
        }
        @media (min-width: 1025px) {
            .main-content { margin-right: 260px; padding: 2rem; }
            .mobile-header { display: none !important; }
        }

        /* Mobile Header */
        .mobile-header {
            background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
            padding: 1.5rem;
            color: white;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 40;
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="p-6 flex items-center gap-3 border-b border-gray-100 mb-4">
            <div class="w-10 h-10 bg-teal-50 rounded-full flex items-center justify-center border border-teal-100">
                <img src="assets/icons/favicon.png" class="w-7 h-7 object-contain">
            </div>
            <div>
                <h1 class="font-bold text-lg text-slate-800">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h1>
                <p class="text-[10px] text-slate-500">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</p>
            </div>
        </div>
        
        <nav>
            <a href="distribution.html" class="nav-item active">
                <i data-lucide="layout-grid" class="w-5 h-5"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            <a href="employee.html" class="nav-item">
                <i data-lucide="briefcase" class="w-5 h-5"></i><span>Ù…Ù‡Ø§Ù…ÙŠ</span>
            </a>
            <a href="forms.html" class="nav-item">
                <i data-lucide="file-text" class="w-5 h-5"></i><span>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</span>
            </a>
            <a href="admin.html" class="nav-item hidden" id="admin-link">
                <i data-lucide="settings-2" class="w-5 h-5"></i><span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
            </a>
        </nav>

        <div class="absolute bottom-0 w-full p-4 border-t border-gray-100 bg-gray-50">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-bold text-slate-800" id="user-name">...</p>
                    <p class="text-[10px] text-slate-500" id="user-role">...</p>
                </div>
                <button onclick="auth.logout()" class="text-red-500 hover:bg-red-50 p-2 rounded-full"><i data-lucide="log-out" class="w-4 h-4"></i></button>
            </div>
        </div>
    </aside>

    <div class="main-content">
        <div class="mobile-header">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm border border-white/30">
                    <img src="assets/icons/favicon.png" class="w-5 h-5 brightness-200">
                </div>
                <h1 class="font-bold text-lg">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</h1>
            </div>
            <button onclick="location.reload()" class="p-2 bg-white/20 rounded-lg backdrop-blur-sm"><i data-lucide="refresh-cw" class="w-5 h-5"></i></button>
        </div>

        <div class="p-4 lg:p-0 max-w-6xl mx-auto space-y-6">
            
            <div class="hidden lg:flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
                    <p class="text-slate-500 text-sm">Ø¥Ù„ÙŠÙƒ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…ÙŠ</p>
                </div>
                <div class="bg-white px-4 py-2 rounded-lg border shadow-sm text-sm font-bold text-slate-600">
                    <i data-lucide="calendar" class="w-4 h-4 inline mr-2 text-[#0f766e]"></i> <span id="current-date">...</span>
                </div>
            </div>

            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mt-4 lg:mt-0">
                
                <div class="stat-card">
                    <div class="stat-icon bg-blue-soft"><i data-lucide="layers" class="w-6 h-6"></i></div>
                    <p class="text-xs text-slate-500 font-bold uppercase">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§Ø±Ø¯</p>
                    <h3 class="text-2xl font-extrabold text-slate-800 mt-1" id="s-total">0</h3>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-orange-soft"><i data-lucide="clock" class="w-6 h-6"></i></div>
                    <p class="text-xs text-slate-500 font-bold uppercase">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                    <h3 class="text-2xl font-extrabold text-slate-800 mt-1" id="s-pending">0</h3>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-green-soft"><i data-lucide="check-circle-2" class="w-6 h-6"></i></div>
                    <p class="text-xs text-slate-500 font-bold uppercase">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
                    <h3 class="text-2xl font-extrabold text-slate-800 mt-1" id="s-done">0</h3>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-red-soft"><i data-lucide="alert-octagon" class="w-6 h-6"></i></div>
                    <p class="text-xs text-slate-500 font-bold uppercase">Ù…ØªØ£Ø®Ø±Ø§Øª</p>
                    <h3 class="text-2xl font-extrabold text-slate-800 mt-1" id="s-late">0</h3>
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                <div class="flex justify-between items-end mb-2">
                    <div>
                        <h3 class="font-bold text-slate-800">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¹Ø§Ù…</h3>
                        <p class="text-xs text-slate-400">Ù…Ø¹Ø¯Ù„ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„ÙˆØ§Ø±Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</p>
                    </div>
                    <span class="text-xl font-bold text-[#0f766e]" id="rate-text">0%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="rate-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                <div class="p-4 border-b flex justify-between items-center bg-gray-50/50">
                    <h3 class="font-bold text-slate-700 text-sm">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full recent-table text-right">
                        <thead>
                            <tr><th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th><th>Ø¬Ù‡Ø© Ø§Ù„Ù…ØµØ¯Ø±</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
                        </thead>
                        <tbody id="recent-table">
                            <tr><td colspan="3" class="text-center p-6 text-slate-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around p-2 pb-safe z-40 lg:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <a href="distribution.html" class="flex flex-col items-center gap-1 p-2 text-[#0f766e]">
            <i data-lucide="layout-grid" class="w-6 h-6"></i><span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="employee.html" class="flex flex-col items-center gap-1 p-2 text-slate-400">
            <i data-lucide="briefcase" class="w-6 h-6"></i><span class="text-[10px]">Ù…Ù‡Ø§Ù…ÙŠ</span>
        </a>
        <a href="forms.html" class="flex flex-col items-center gap-1 p-2 text-slate-400">
            <i data-lucide="file-text" class="w-6 h-6"></i><span class="text-[10px]">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</span>
        </a>
    </nav>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        lucide.createIcons();
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('ar-EG');

        document.addEventListener('DOMContentLoaded', async () => {
            const user = auth.checkAuth();
            if(!user) return;

            document.getElementById('user-name').textContent = user.name;
            document.getElementById('user-role').textContent = user.role;

            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ùˆ ÙƒØ§Ù† Ø£Ø¯Ù…Ù†
            if(user.role === 'admin' || user.role === 'Ù…Ø¯ÙŠØ±') {
                document.getElementById('admin-link').classList.remove('hidden');
            }

            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const startDate = `${new Date().getFullYear()}-01-01`;
            const res = await auth.callAPI('getAllData', { role: user.role, name: user.name, startDate });
            
            if(res.success) {
                const s = res.stats.totals;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                animateValue('s-total', s.total);
                animateValue('s-pending', s.inProgress);
                animateValue('s-done', s.completed);
                animateValue('s-late', s.overdue);

                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
                const rate = s.total > 0 ? Math.round((s.completed / s.total) * 100) : 0;
                document.getElementById('rate-text').textContent = rate + '%';
                document.getElementById('rate-bar').style.width = rate + '%';

                // Ø§Ù„Ø¬Ø¯ÙˆÙ„
                const rows = res.tasks.slice(0,5).map(t => {
                    let badgeClass = 'bg-slate-100 text-slate-600';
                    if(t.status.includes('ØªÙ…')) badgeClass = 'bg-emerald-50 text-emerald-600 border border-emerald-100';
                    else if(t.status.includes('Ù…ØªØ£Ø®Ø±')) badgeClass = 'bg-red-50 text-red-600 border border-red-100';
                    else if(t.status.includes('Ø¬Ø§Ø±ÙŠ')) badgeClass = 'bg-blue-50 text-blue-600 border border-blue-100';

                    return `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="font-bold truncate max-w-[150px]">${t.subject}</td>
                        <td class="text-xs">${t.source}</td>
                        <td><span class="text-[10px] px-2 py-1 rounded-md ${badgeClass}">${t.status}</span></td>
                    </tr>`;
                }).join('');
                document.getElementById('recent-table').innerHTML = rows || '<tr><td colspan="3" class="text-center p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
            }
        });

        // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø£Ø±Ù‚Ø§Ù…
        function animateValue(id, end) {
            const obj = document.getElementById(id);
            let start = 0;
            const duration = 1000;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * end);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>
