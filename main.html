<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0f766e">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø© - Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„ØµØ­Ø©</title>
  
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="assets/js/api.js"></script>

  <style>
    /* â”€â”€ Ø£Ø³Ø§Ø³ÙŠØ§Øª â”€â”€ */
    body { 
      font-family: 'Cairo', sans-serif; 
      background-color: #f8fafc;
      overscroll-behavior-y: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none; user-select: none;
    }
    
    /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ù‡Ù…Ø© */
    h1, h2, h3, p, span, td, th { -webkit-user-select: text; user-select: text; }
    
    /* Ù…Ù†Ø¹ ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· ÙÙŠ Ø§Ù„Ø¢ÙŠÙÙˆÙ† */
    input, select, textarea { font-size: 16px !important; }

    /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· */
    button:active, .card-press:active { transform: scale(0.97); transition: 0.1s; }

    /* â”€â”€ ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© â”€â”€ */
    .hidden-section { display: none !important; }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* Sidebar Active State */
    .sidebar-active { background-color: #0f766e; color: white; border-right: 4px solid #ccfbf1; }

    /* Mobile Bottom Nav Fixes */
    @media (max-width: 768px) {
      .desktop-only { display: none !important; }
      
      .bottom-nav { 
        display: flex !important; 
        position: fixed; bottom: 0; left: 0; right: 0; 
        background: white; border-top: 1px solid #e2e8f0; z-index: 1000;
        padding-bottom: env(safe-area-inset-bottom);
        height: calc(65px + env(safe-area-inset-bottom));
        box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
      }
      
      .bottom-nav button {
        flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
        gap: 4px; color: #94a3b8; font-size: 0.7rem; font-weight: 700; border: none; background: transparent;
      }
      
      .bottom-nav button.active { color: #0f766e; }
      .bottom-nav button svg { width: 24px; height: 24px; }

      /* Ø±ÙØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ø¹Ø¯Ù… Ø§Ù„Ø§Ø®ØªÙØ§Ø¡ Ø®Ù„Ù Ø§Ù„Ø¨Ø§Ø± */
      .main-content { 
        padding-bottom: calc(90px + env(safe-area-inset-bottom)) !important;
      }

      /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù„ÙƒØ±ÙˆØª */
      .mobile-card-grid { display: grid; gap: 12px; }
      .mobile-card { 
        background: white; padding: 16px; border-radius: 12px; 
        border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        display: flex; flex-direction: column; gap: 8px;
      }
    }

    @media (min-width: 769px) {
      .mobile-only { display: none !important; }
      .bottom-nav { display: none !important; }
    }
    
    /* Toast Notification */
    #toast-container { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); z-index: 2000; width: 90%; max-width: 400px; pointer-events: none; }
    .toast { background: #1e293b; color: white; padding: 12px 20px; border-radius: 50px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); font-weight: bold; font-size: 0.9rem; opacity: 0; transition: 0.3s; transform: translateY(20px); pointer-events: auto; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.error { background: #ef4444; }
    .toast.success { background: #10b981; }
  </style>
</head>
<body class="min-h-screen flex flex-col overflow-hidden">

  <div id="toast-container"></div>

  <div class="flex-grow flex h-screen overflow-hidden">
    
    <aside class="desktop-only w-64 bg-white border-l border-slate-200 flex flex-col shadow-lg z-20 shrink-0">
      <div class="p-6 text-center border-b border-slate-100">
        <h2 class="font-bold text-slate-800 text-lg">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h2>
      </div>
      <nav class="flex-grow p-4 space-y-2">
        <button onclick="switchTab('dashboard')" class="w-full flex items-center gap-3 p-3 rounded-lg font-bold sidebar-active nav-btn" data-target="dashboard">
          <i data-lucide="layout-grid"></i> Dashboard
        </button>
        <button onclick="switchTab('services')" class="w-full flex items-center gap-3 p-3 rounded-lg font-medium text-slate-600 hover:bg-slate-50 nav-btn" data-target="services">
          <i data-lucide="briefcase"></i> Ø§Ù„Ø®Ø¯Ù…Ø§Øª
        </button>
        <button onclick="switchTab('employees')" class="w-full flex items-center gap-3 p-3 rounded-lg font-medium text-slate-600 hover:bg-slate-50 nav-btn" data-target="employees">
          <i data-lucide="users-2"></i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        </button>
        <a href="admin.html" class="w-full flex items-center gap-3 p-3 rounded-lg font-medium text-slate-600 hover:bg-red-50 hover:text-red-600">
          <i data-lucide="settings-2"></i> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        </a>
      </nav>
      <div class="p-4"><button onclick="window.location.href='index.html'" class="text-red-500 font-bold text-sm">Ø®Ø±ÙˆØ¬</button></div>
    </aside>

    <main class="flex-1 flex flex-col bg-slate-50 overflow-hidden relative">
      <div class="flex-1 overflow-y-auto scroll-smooth no-scrollbar main-content p-4 md:p-6">

        <div id="tab-dashboard" class="tab-content fade-in">
          <div class="flex flex-col gap-4 mb-6">
            <div class="flex justify-between items-center">
              <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                <i data-lucide="activity" class="text-teal-600"></i> Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
              </h2>
              <button onclick="applyFilter(); vibrateDevice();" class="p-2 bg-white border border-slate-200 rounded-full shadow-sm active:scale-90 transition">
                <i data-lucide="refresh-cw" class="w-5 h-5 text-slate-600"></i>
              </button>
            </div>
            
            <div class="bg-white p-2 rounded-xl border border-slate-200 shadow-sm flex flex-wrap gap-2 items-center">
               <select id="year-select" class="bg-transparent font-bold text-sm outline-none px-2"><option value="2025" selected>2025</option><option value="2024">2024</option></select>
               <div class="h-4 w-[1px] bg-slate-300"></div>
               <select id="filter-type" class="bg-transparent font-bold text-sm outline-none px-2 flex-grow" onchange="toggleInputs()">
                 <option value="current">Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</option>
                 <option value="all">Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
                 <option value="month">Ø´Ù‡Ø± Ù…Ø­Ø¯Ø¯</option>
               </select>
               <div id="month-input" class="hidden-section"><select id="month-select" class="bg-slate-100 rounded px-2 py-1 text-sm"><option value="0">ÙŠÙ†Ø§ÙŠØ±</option><option value="1">ÙØ¨Ø±Ø§ÙŠØ±</option></select></div>
               <button onclick="applyFilter()" class="bg-teal-600 text-white px-4 py-1.5 rounded-lg text-sm font-bold">Ø¨Ø­Ø«</button>
            </div>
          </div>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
              <p class="text-xs font-bold text-slate-400 mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
              <h3 id="v-total" class="text-2xl md:text-3xl font-black text-slate-800">--</h3>
            </div>
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center border-b-4 border-emerald-500">
              <p class="text-xs font-bold text-slate-400 mb-1">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</p>
              <h3 id="v-done" class="text-2xl md:text-3xl font-black text-emerald-600">--</h3>
            </div>
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center border-b-4 border-amber-500">
              <p class="text-xs font-bold text-slate-400 mb-1">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„</p>
              <h3 id="v-prog" class="text-2xl md:text-3xl font-black text-amber-500">--</h3>
            </div>
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center border-b-4 border-red-500">
              <p class="text-xs font-bold text-slate-400 mb-1">Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª</p>
              <h3 id="v-late" class="text-2xl md:text-3xl font-black text-red-600">--</h3>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2"><i data-lucide="users"></i> Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
            
            <div class="desktop-only bg-white rounded-xl border border-slate-200 overflow-hidden">
              <table class="w-full text-right text-sm">
                <thead class="bg-slate-50 text-slate-600 font-bold">
                  <tr><th class="p-3">Ø§Ù„Ù…ÙˆØ¸Ù</th><th class="p-3 text-center">Ø§Ù„ØªÙƒÙ„ÙŠÙØ§Øª</th><th class="p-3 text-center">Ù…Ù†Ø¬Ø²</th><th class="p-3 text-center">Ø¬Ø§Ø±ÙŠ</th></tr>
                </thead>
                <tbody id="table-rows-desktop"></tbody>
              </table>
            </div>

            <div id="table-rows-mobile" class="mobile-only mobile-card-grid"></div>
          </div>

          <div>
            <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2"><i data-lucide="building-2"></i> Ù…ÙˆÙ‚Ù Ø§Ù„Ø¬Ù‡Ø§Øª</h3>
            
            <div class="desktop-only bg-white rounded-xl border border-slate-200 overflow-hidden">
              <table class="w-full text-right text-sm">
                <thead class="bg-slate-50 text-slate-600 font-bold">
                  <tr><th class="p-3">Ø§Ù„Ø¬Ù‡Ø©</th><th class="p-3 text-center">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th class="p-3 text-center">Ù‚ÙŠØ¯ Ø§Ù„ÙØ­Øµ</th><th class="p-3 text-center">Ù…ØªØ£Ø®Ø±</th></tr>
                </thead>
                <tbody id="entity-rows-desktop"></tbody>
              </table>
            </div>

            <div id="entity-rows-mobile" class="mobile-only mobile-card-grid"></div>
          </div>
        </div>

        <div id="tab-services" class="tab-content hidden-section fade-in">
          <h2 class="text-2xl font-bold text-slate-800 mb-4">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h2>
          <div class="grid grid-cols-1 gap-4">
             <a href="https://forms.gle/A68F79PpJXHsfzXS9" target="_blank" class="card-press bg-white p-4 rounded-xl border border-slate-200 flex items-center gap-4 shadow-sm">
               <div class="w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center"><i data-lucide="building-2"></i></div>
               <span class="font-bold text-slate-700">Ù…Ø±ÙˆØ± Ù…Ø³ØªØ´ÙÙŠØ§Øª</span>
             </a>
             <a href="https://forms.gle/49ku3m4hAjqnqxKE6" target="_blank" class="card-press bg-white p-4 rounded-xl border border-slate-200 flex items-center gap-4 shadow-sm">
               <div class="w-12 h-12 rounded-lg bg-emerald-50 text-emerald-600 flex items-center justify-center"><i data-lucide="building"></i></div>
               <span class="font-bold text-slate-700">Ù…Ø±ÙˆØ± ÙˆØ­Ø¯Ø§Øª</span>
             </a>
             </div>
        </div>

        <div id="tab-employees" class="tab-content hidden-section fade-in flex flex-col items-center justify-center h-full">
          
          <div id="emp-login-form" class="bg-white w-full max-w-sm p-6 rounded-2xl shadow-lg border border-slate-100 text-center">
            <div class="w-16 h-16 bg-violet-50 text-violet-600 rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="lock" class="w-8 h-8"></i>
            </div>
            <h3 class="text-lg font-bold text-slate-800 mb-2">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸Ù</h3>
            
            <input type="password" id="emp-pin-input" placeholder="****" maxlength="4" inputmode="numeric" pattern="[0-9]*" class="w-full text-center text-3xl tracking-widest border border-slate-200 rounded-xl p-3 mb-4 focus:border-violet-500 outline-none">
            
            <button onclick="handleLogin()" class="w-full bg-violet-600 text-white font-bold py-3 rounded-xl hover:bg-violet-700 transition card-press">
              ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
          </div>

          <div id="emp-profile-view" class="hidden-section w-full">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-4 flex items-center justify-between">
               <div>
                 <h2 id="profile-name" class="font-bold text-slate-800">...</h2>
                 <p id="profile-role" class="text-xs text-slate-500">...</p>
               </div>
               <button onclick="logout()" class="text-red-500 bg-red-50 px-3 py-1 rounded-lg text-sm font-bold">Ø®Ø±ÙˆØ¬</button>
            </div>
            
            <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar pb-2">
               <button class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap">ğŸ“¥ Ø§Ù„ÙˆØ§Ø±Ø¯</button>
               <button class="bg-white text-slate-600 px-4 py-2 rounded-lg text-sm font-bold border border-slate-200 whitespace-nowrap">â³ Ø¬Ø§Ø±ÙŠ</button>
            </div>

            <div id="cards-new" class="grid gap-3"></div>
            </div>

        </div>

      </div>
    </main>

    <nav class="bottom-nav">
      <button onclick="switchTab('dashboard')" id="nav-btn-dashboard" class="active">
        <i data-lucide="layout-grid"></i>
        <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </button>
      <button onclick="switchTab('services')" id="nav-btn-services">
        <i data-lucide="briefcase"></i>
        <span>Ø§Ù„Ø®Ø¯Ù…Ø§Øª</span>
      </button>
      <button onclick="switchTab('employees')" id="nav-btn-employees">
        <i data-lucide="users-2"></i>
        <span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
      </button>
    </nav>

  </div>

  <div id="loader" class="fixed inset-0 bg-white/90 z-[3000] flex flex-col items-center justify-center hidden-section">
    <div class="w-12 h-12 border-4 border-teal-600 border-t-transparent rounded-full animate-spin mb-3"></div>
    <p class="font-bold text-slate-700">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
  </div>

  <script>
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
    lucide.createIcons();

    // â”€â”€ 1. Navigation Logic (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙ†Ù‚Ù„) â”€â”€
    function switchTab(tabName) {
      // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØªØ§Ø¨Ø§Øª
      document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden-section'));
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
      const target = document.getElementById('tab-' + tabName);
      if(target) target.classList.remove('hidden-section');

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Active State)
      document.querySelectorAll('.bottom-nav button, .nav-btn').forEach(btn => {
        btn.classList.remove('active', 'sidebar-active', 'text-teal-600');
        // Mobile Active
        if(btn.id === 'nav-btn-' + tabName) btn.classList.add('active');
        // Desktop Active
        if(btn.dataset.target === tabName) btn.classList.add('sidebar-active');
      });

      // Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ· Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
      vibrateDevice();
      lucide.createIcons();
    }

    // â”€â”€ 2. Helper Functions â”€â”€
    function vibrateDevice() {
      if (navigator.vibrate) navigator.vibrate(10);
    }

    function showToast(msg, type='success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = type === 'error' ? `<i data-lucide="alert-circle" class="w-4 h-4"></i> ${msg}` : `<i data-lucide="check" class="w-4 h-4"></i> ${msg}`;
      container.appendChild(toast);
      lucide.createIcons();
      
      // Animation
      setTimeout(() => toast.classList.add('show'), 10);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function toggleLoader(show) {
      const loader = document.getElementById('loader');
      if(show) loader.classList.remove('hidden-section');
      else loader.classList.add('hidden-section');
    }

    // â”€â”€ 3. Data Logic (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶) â”€â”€
    async function applyFilter() {
      toggleLoader(true);
      try {
        // Mocking Data fetch if api.js fails or using real one
        // Ù‡Ù†Ø§ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØµØ­ÙŠØ­
        const start = document.getElementById('year-select').value + '-01-01';
        const end = document.getElementById('year-select').value + '-12-31';
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù€ API
        // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ø£Ù† getDashboard Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ api.js
        if(typeof getDashboard === 'undefined') {
           throw new Error("Ù…Ù„Ù Ø§Ù„Ø§ØªØµØ§Ù„ (api.js) ØºÙŠØ± Ù…Ø­Ù…Ù„");
        }

        const data = await getDashboard(start, end); // Ø¯Ø§Ù„Ø© Ù…Ù† api.js
        
        if (!data || !data.totals) throw new Error("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");

        // ğŸŸ¢ ØªØµØ­ÙŠØ­ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Math Fix)
        const total = data.totals.periodTotal || 0;
        const done = data.totals.periodCompleted || 0;
        const overdue = data.totals.absoluteOverdue || 0;
        
        // Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø¹Ø´Ø§Ù† ÙŠØ¸Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)
        // Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ = Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ - Ø§Ù„Ù…Ù†Ø¬Ø²
        const inProgress = total - done; 

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        animateValue("v-total", total);
        animateValue("v-done", done);
        animateValue("v-prog", inProgress); // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ­Ø­
        animateValue("v-late", overdue);

        // ğŸŸ¢ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Desktop & Mobile)
        renderEmployees(data.employees);

        // ğŸŸ¢ ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ù Ø§Ù„Ø¬Ù‡Ø§Øª (Desktop & Mobile)
        renderEntities(data.entities);

        showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

      } catch (error) {
        console.error(error);
        showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
      } finally {
        toggleLoader(false);
      }
    }

    // Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (ÙƒØ±ÙˆØª Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ¬Ø¯ÙˆÙ„ Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)
    function renderEmployees(list) {
      const desktopBody = document.getElementById('table-rows-desktop');
      const mobileGrid = document.getElementById('table-rows-mobile');
      
      desktopBody.innerHTML = '';
      mobileGrid.innerHTML = '';

      if(!list || list.length === 0) {
        mobileGrid.innerHTML = '<p class="text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        return;
      }

      list.forEach(emp => {
        // Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ù„ØªÙƒÙˆÙ† Ù…ØªØ³Ù‚Ø©
        const empTotal = emp.periodTotal || 0;
        const empDone = emp.periodCompleted || 0;
        const empProg = empTotal - empDone; // ØªØµØ­ÙŠØ­

        // 1. Desktop Row
        desktopBody.innerHTML += `
          <tr class="border-b hover:bg-slate-50">
            <td class="p-3 font-bold text-slate-800">${emp.name}</td>
            <td class="p-3 text-center">${empTotal}</td>
            <td class="p-3 text-center text-emerald-600 font-bold">${empDone}</td>
            <td class="p-3 text-center text-amber-500 font-bold">${empProg}</td>
          </tr>
        `;

        // 2. Mobile Card (New!)
        mobileGrid.innerHTML += `
          <div class="mobile-card">
            <div class="flex justify-between items-center">
              <h4 class="font-bold text-slate-800">${emp.name}</h4>
              <span class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded font-bold">Ù…Ø¬Ù…ÙˆØ¹: ${empTotal}</span>
            </div>
            <div class="flex gap-2 mt-2">
              <div class="flex-1 bg-emerald-50 text-emerald-700 text-center py-2 rounded-lg text-sm font-bold">
                 âœ… ${empDone}
              </div>
              <div class="flex-1 bg-amber-50 text-amber-700 text-center py-2 rounded-lg text-sm font-bold">
                 â³ ${empProg}
              </div>
            </div>
          </div>
        `;
      });
    }

    // Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Øª
    function renderEntities(list) {
      const desktopBody = document.getElementById('entity-rows-desktop');
      const mobileGrid = document.getElementById('entity-rows-mobile');
      
      desktopBody.innerHTML = '';
      mobileGrid.innerHTML = '';

      if(!list) return;

      list.forEach(ent => {
        // Desktop
        desktopBody.innerHTML += `
          <tr class="border-b hover:bg-slate-50">
            <td class="p-3 font-bold text-slate-700 text-xs">${ent.name}</td>
            <td class="p-3 text-center text-blue-600 font-bold">${ent.total}</td>
            <td class="p-3 text-center text-amber-600">${ent.pending}</td>
            <td class="p-3 text-center text-red-600 font-bold">${ent.overdue}</td>
          </tr>
        `;

        // Mobile Card
        mobileGrid.innerHTML += `
          <div class="mobile-card flex-row justify-between items-center">
             <div class="flex-1">
               <h4 class="font-bold text-slate-800 text-sm mb-1">${ent.name}</h4>
               <div class="flex gap-2 text-xs">
                 <span class="text-amber-600 font-bold">ÙØ­Øµ: ${ent.pending}</span>
                 <span class="text-red-600 font-bold">Ù…ØªØ£Ø®Ø±: ${ent.overdue}</span>
               </div>
             </div>
             <div class="bg-blue-50 text-blue-700 px-3 py-2 rounded-lg font-bold text-lg">
               ${ent.total}
             </div>
          </div>
        `;
      });
    }

    // â”€â”€ 4. Login Logic (Ø¥ØµÙ„Ø§Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) â”€â”€
    async function handleLogin() {
      const pin = document.getElementById('emp-pin-input').value;
      if (!pin || pin.length < 4) {
        showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ (4 Ø£Ø±Ù‚Ø§Ù…)", "error");
        return;
      }
      
      vibrateDevice();
      toggleLoader(true);

      try {
        if(typeof login === 'undefined') throw new Error("API ØºÙŠØ± Ù…Ø­Ù…Ù„");
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© login Ù…Ù† Ù…Ù„Ù api.js
        const response = await login(pin); 
        
        if (response && response.success) {
          showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
          document.getElementById('emp-login-form').classList.add('hidden-section');
          document.getElementById('emp-profile-view').classList.remove('hidden-section');
          
          document.getElementById('profile-name').innerText = response.name;
          document.getElementById('profile-role').innerText = response.role;
          
          // ØªØ­Ù…ÙŠÙ„ Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù‡Ù†Ø§ (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        } else {
          showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
        }
      } catch (e) {
        console.error(e);
        showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±", "error");
      } finally {
        toggleLoader(false);
      }
    }

    function logout() {
      document.getElementById('emp-profile-view').classList.add('hidden-section');
      document.getElementById('emp-login-form').classList.remove('hidden-section');
      document.getElementById('emp-pin-input').value = '';
    }

    // Helper Animation
    function animateValue(id, end) {
      const obj = document.getElementById(id);
      if(!obj) return;
      obj.innerText = end; // Direct update for now
    }
    
    // Initial Load
    window.onload = function() {
      applyFilter();
    };
  </script>
</body>
</html>
