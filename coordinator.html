<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f766e">
  <title>Ø§Ù„Ù…Ù†Ø³Ù‚ - IAG</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 1. BASE STYLES */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    body { 
      font-family: 'Cairo', sans-serif; 
      background: #f8f9fa;
      margin: 0;
      padding-bottom: 70px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 2. SIDEBAR (Desktop) */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .sidebar {
      position: fixed;
      right: 0;
      top: 0;
      width: 260px;
      height: 100vh;
      background: white;
      box-shadow: -2px 0 10px rgba(0,0,0,0.08);
      z-index: 100;
      overflow-y: auto;
    }
    
    .sidebar-logo {
      padding: 24px;
      background: linear-gradient(135deg, #0f766e, #115e59);
      color: white;
    }
    
    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 24px;
      color: #495057;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
      border-right: 3px solid transparent;
    }
    
    .sidebar-item:hover, .sidebar-item.active {
      background: #e6f7f5;
      border-right-color: #0f766e;
      color: #0f766e;
    }
    
    .sidebar-item.hidden {
      display: none;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 3. BOTTOM NAVIGATION (Mobile) */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 200;
      display: none;
    }
    
    .bottom-nav-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 0;
    }
    
    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px 8px;
      color: #64748b;
      text-decoration: none;
      font-size: 0.7rem;
      font-weight: 600;
      transition: all 0.2s;
      border-top: 3px solid transparent;
    }
    
    .bottom-nav-item:hover, .bottom-nav-item.active {
      background: #e6f7f5;
      border-top-color: #0f766e;
      color: #0f766e;
    }
    
    .bottom-nav-item.hidden {
      display: none;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 4. MAIN CONTENT */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .main-content {
      margin-right: 260px;
      padding: 24px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-bottom: 20px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 5. FILTERS */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    
    select {
      width: 100%;
      padding: 10px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.875rem;
    }
    
    select:focus {
      outline: none;
      border-color: #0f766e;
    }
    
    button {
      background: #0f766e;
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      width: 100%;
    }
    
    button:hover {
      background: #115e59;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 6. EMPLOYEE GROUPS */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .employee-group {
      margin-bottom: 30px;
    }
    
    .employee-header {
      background: linear-gradient(135deg, #0f766e, #115e59);
      color: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 7. TASK CARDS */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .task-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }
    
    .task-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 16px;
      transition: all 0.2s;
    }
    
    .task-card:hover {
      border-color: #0f766e;
      box-shadow: 0 2px 12px rgba(15,118,110,0.1);
    }
    
    .task-done {
      background: #f0fdf4;
      border-color: #86efac;
    }
    
    .task-pending {
      background: #fffbeb;
      border-color: #fde68a;
    }
    
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 700;
    }
    
    .badge-done { background: #dcfce7; color: #166534; }
    .badge-pending { background: #fef3c7; color: #92400e; }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* 8. RESPONSIVE */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    @media (max-width: 1024px) {
      .sidebar { 
        transform: translateX(100%);
      }
      .main-content { 
        margin-right: 0; 
      }
      .bottom-nav {
        display: block;
      }
    }
    
    @media (max-width: 640px) {
      .task-grid {
        grid-template-columns: 1fr;
      }
      .filter-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- 1. SIDEBAR (Desktop) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <h2 class="text-xl font-bold mb-1">IAG System</h2>
      <p id="user-name-sidebar" class="text-sm opacity-90">Ù…Ø±Ø­Ø¨Ø§Ù‹</p>
    </div>
    
    <nav class="py-4" id="sidebar-nav">
      <a href="index.html" class="sidebar-item" data-page="home">
        <i data-lucide="home" class="w-5 h-5"></i>
        <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </a>
      
      <a href="distribution.html" class="sidebar-item" data-page="dashboard">
        <i data-lucide="pie-chart" class="w-5 h-5"></i>
        <span>Dashboard</span>
      </a>
      
      <a href="forms.html" class="sidebar-item" data-page="forms">
        <i data-lucide="file-text" class="w-5 h-5"></i>
        <span>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</span>
      </a>
      
      <a href="coordinator.html" class="sidebar-item active" data-page="coordinator" data-role="Ù…Ù†Ø³Ù‚,Ù…Ø¯ÙŠØ±">
        <i data-lucide="users" class="w-5 h-5"></i>
        <span>Ø§Ù„Ù…Ù†Ø³Ù‚ÙŠÙ†</span>
      </a>
      
      <a href="admin.html" class="sidebar-item" data-page="admin" data-role="Ù…Ø¯ÙŠØ±">
        <i data-lucide="settings" class="w-5 h-5"></i>
        <span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
      </a>
      
      <a href="#" onclick="auth.logout(); return false;" class="sidebar-item" data-page="logout">
        <i data-lucide="log-out" class="w-5 h-5"></i>
        <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
      </a>
    </nav>
  </aside>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- 2. BOTTOM NAVIGATION (Mobile) -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="bottom-nav">
    <div class="bottom-nav-grid" id="bottom-nav-grid">
      <a href="index.html" class="bottom-nav-item" data-page="home">
        <i data-lucide="home" class="w-5 h-5"></i>
        <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </a>
      
      <a href="distribution.html" class="bottom-nav-item" data-page="dashboard">
        <i data-lucide="pie-chart" class="w-5 h-5"></i>
        <span>Dashboard</span>
      </a>
      
      <a href="forms.html" class="bottom-nav-item" data-page="forms">
        <i data-lucide="file-text" class="w-5 h-5"></i>
        <span>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</span>
      </a>
      
      <a href="coordinator.html" class="bottom-nav-item active" data-page="coordinator" data-role="Ù…Ù†Ø³Ù‚,Ù…Ø¯ÙŠØ±">
        <i data-lucide="users" class="w-5 h-5"></i>
        <span>Ø§Ù„Ù…Ù†Ø³Ù‚ÙŠÙ†</span>
      </a>
      
      <a href="admin.html" class="bottom-nav-item" data-page="admin" data-role="Ù…Ø¯ÙŠØ±">
        <i data-lucide="settings" class="w-5 h-5"></i>
        <span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
      </a>
    </div>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- 3. MAIN CONTENT -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main class="main-content">
    
    <!-- 3.1 Header Card -->
    <div class="card" style="background: linear-gradient(135deg, #0f766e, #115e59); color: white;">
      <h1 style="font-size: 1.75rem; font-weight: 800;">ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø³Ù‚</h1>
      <p id="user-name-header" class="text-sm opacity-90 mt-2">Ù…Ø±Ø­Ø¨Ø§Ù‹</p>
    </div>

    <!-- 3.2 Filters Card -->
    <div class="card">
      <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 16px;">Ø§Ù„ÙÙ„Ø§ØªØ±</h2>
      
      <div class="filter-grid">
        <!-- 3.2.1 Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© -->
        <div>
          <label style="display: block; font-weight: 700; font-size: 0.875rem; margin-bottom: 8px;">Ø§Ù„ÙØªØ±Ø©</label>
          <select id="period-filter">
            <option value="week" selected>Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹</option>
            <option value="month">Ø¢Ø®Ø± Ø´Ù‡Ø±</option>
            <option value="3months">Ø¢Ø®Ø± 3 Ø£Ø´Ù‡Ø±</option>
            <option value="year">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</option>
            <option value="all">Ø§Ù„ÙƒÙ„</option>
          </select>
        </div>

        <!-- 3.2.2 Ø§Ù„Ù…ÙˆØ¸Ù -->
        <div>
          <label style="display: block; font-weight: 700; font-size: 0.875rem; margin-bottom: 8px;">Ø§Ù„Ù…ÙˆØ¸Ù</label>
          <select id="emp-filter">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
            <option value="ALL_FINANCIAL">ğŸ”¹ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
            <option value="ALL_TECHNICAL">ğŸ”§ Ø§Ù„ÙÙ†ÙŠÙŠÙ†</option>
          </select>
        </div>
      </div>

      <button onclick="loadData()">ğŸ” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
    </div>

    <!-- 3.3 Results -->
    <div id="results" style="color: #94a3b8; text-align: center; padding: 40px;">
      Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
    </div>

  </main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- 4. SCRIPTS -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script src="assets/js/config.js"></script>
  <script src="assets/js/auth.js"></script>
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 1. INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    lucide.createIcons();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 2. SECURITY & AUTHENTICATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // 2.1 Check Session
    const user = auth.checkSession();
    if (!user) {
      alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
      window.location.replace('index.html');
    }
    
    // 2.2 Check Role Access
    const allowedRoles = ['Ù…Ù†Ø³Ù‚', 'Coordinator', 'Ù…Ø¯ÙŠØ±', 'Admin'];
    if (!allowedRoles.includes(user.role)) {
       alert('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©');
       window.location.replace('index.html');
    }

    // 2.3 Display User Info
    document.getElementById('user-name-sidebar').textContent = `${user.name} ğŸ‘‹`;
    document.getElementById('user-name-header').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name} - ${user.jobTitle || user.role}`;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 3. ROLE-BASED NAVIGATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // 3.1 Hide/Show Menu Items Based on Role
    function setupNavigation() {
      const userRole = user.role;
      
      const allNavItems = [
        ...document.querySelectorAll('.sidebar-item[data-role]'),
        ...document.querySelectorAll('.bottom-nav-item[data-role]')
      ];
      
      allNavItems.forEach(item => {
        const requiredRoles = item.getAttribute('data-role').split(',');
        
        if (!requiredRoles.some(role => userRole.includes(role))) {
          item.classList.add('hidden');
        }
      });
    }
    
    setupNavigation();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 4. DATA MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // 4.1 Global Variables
    let allEmployees = [];
    let allTasks = [];

    // 4.2 Helper: Sanitization
    function escapeHtml(text) {
      if (!text) return '';
      return text.toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // 4.3 Get Date Range (Ù†ÙØ³ Ø§Ù„Ù€ Admin)
    function getDateRange() {
      const today = new Date();
      const period = document.getElementById('period-filter').value;
      let start = new Date(today);
      
      switch(period) {
        case 'week': start.setDate(today.getDate() - 7); break;
        case 'month': start.setMonth(today.getMonth() - 1); break;
        case '3months': start.setMonth(today.getMonth() - 3); break;
        case 'year': start = new Date(today.getFullYear(), 0, 1); break;
        case 'all': start = new Date('2020-01-01'); break;
      }
      
      return {
        start: start.toISOString().split('T')[0],
        end: today.toISOString().split('T')[0]
      };
    }

    // 4.4 Load Data (Ù†ÙØ³ Ø§Ù„Ù€ Admin)
    async function loadData() {
      document.getElementById('results').innerHTML = '<div style="color: #94a3b8; text-align: center; padding: 40px;">â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

      try {
        const range = getDateRange();
        
        // ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… getAllData Ø¨Ø¯Ù„ getDashboardData
        const result = await auth.apiCall('getAllData', {
          role: user.role || 'Ù…Ù†Ø³Ù‚',
          name: user.name,
          startDate: range.start,
          endDate: range.end
        });

        if (!result || !result.success) throw new Error('ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„');

        allTasks = result.tasks || [];
        allEmployees = result.stats.employees || [];

        // 4.4.1 Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        const empFilter = document.getElementById('emp-filter');
        let options = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>';
        options += '<option value="ALL_FINANCIAL">ğŸ”¹ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>';
        options += '<option value="ALL_TECHNICAL">ğŸ”§ Ø§Ù„ÙÙ†ÙŠÙŠÙ†</option>';
        options += '<optgroup label="Ø£ÙØ±Ø§Ø¯">';
        allEmployees.forEach(e => {
          options += `<option value="${escapeHtml(e.name)}">${escapeHtml(e.name)}</option>`;
        });
        options += '</optgroup>';
        
        if (empFilter.options.length <= 3) {
            empFilter.innerHTML = options;
        }

        filterAndDisplay();

      } catch (err) {
        console.error('Error:', err);
        document.getElementById('results').innerHTML = `<div style="color: #dc2626; text-align: center; padding: 40px;">âŒ ${escapeHtml(err.message)}</div>`;
      }
    }

    // 4.5 Filter and Display
function filterAndDisplay() {
  const empFilter = document.getElementById('emp-filter').value;
  let filtered = allTasks;

  if (empFilter === 'ALL_FINANCIAL') {
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ
    const names = allEmployees.filter(e => 
      e.jobTitle && e.jobTitle.includes('Ù…Ø±Ø§Ø¬Ø¹ Ù…Ø§Ù„ÙŠ')
    ).map(e => e.name);
    filtered = allTasks.filter(t => names.some(n => t.assignee && t.assignee.includes(n)));
  } else if (empFilter === 'ALL_TECHNICAL') {
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ
    const names = allEmployees.filter(e => 
      e.jobTitle && e.jobTitle.includes('Ù…Ø±Ø§Ø¬Ø¹ ÙÙ†ÙŠ')
    ).map(e => e.name);
    filtered = allTasks.filter(t => names.some(n => t.assignee && t.assignee.includes(n)));
  } else if (empFilter) {
    filtered = allTasks.filter(t => t.assignee && t.assignee.includes(empFilter));
  }

  displayTasks(filtered);
}
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 5. DISPLAY TASKS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // 5.1 Main Display Function
    function displayTasks(tasks) {
      const container = document.getElementById('results');

      if (!tasks || tasks.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 60px; color: #94a3b8;"><div style="font-size: 3rem;">ğŸ”­</div><p style="font-weight: 600; margin-top: 12px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©</p></div>';
        return;
      }

      // 5.1.1 Group by Employee
      const grouped = {};
      tasks.forEach(t => {
        const emp = t.assignee || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!grouped[emp]) grouped[emp] = [];
        grouped[emp].push(t);
      });

      let html = '';

      // 5.1.2 Build HTML
      Object.entries(grouped).forEach(([emp, empTasks]) => {
        const done = empTasks.filter(t => {
          const s = t.status || '';
          return s.includes('ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯') || s.includes('Ù…Ù†ØªÙ‡ÙŠ') || s.includes('Ø£Ø±Ø´ÙŠÙ');
        }).length;

        html += `
          <div class="employee-group">
            <div class="employee-header">
              <div>
                <div style="font-size: 1.25rem; font-weight: 800;">${escapeHtml(emp)}</div>
                <div style="font-size: 0.875rem; opacity: 0.9;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${empTasks.length}</div>
              </div>
              <div style="display: flex; gap: 20px;">
                <div style="text-align: center;">
                  <div style="font-size: 1.5rem; font-weight: 800;">${done}</div>
                  <div style="font-size: 0.75rem; opacity: 0.9;">Ù…Ù†ØªÙ‡ÙŠ</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 1.5rem; font-weight: 800;">${empTasks.length - done}</div>
                  <div style="font-size: 0.75rem; opacity: 0.9;">Ø¬Ø§Ø±ÙŠ</div>
                </div>
              </div>
            </div>

            <div class="task-grid">
            ${empTasks.map(t => {
              const isDone = (t.status || '').includes('ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯') || (t.status || '').includes('Ù…Ù†ØªÙ‡ÙŠ') || (t.status || '').includes('Ø£Ø±Ø´ÙŠÙ');
              
              return `
                <div class="task-card ${isDone ? 'task-done' : 'task-pending'}">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <div style="font-weight: 700; color: #1e293b;">${escapeHtml(t.id)}</div>
                    <span class="badge ${isDone ? 'badge-done' : 'badge-pending'}">
                      ${isDone ? 'âœ… Ù…Ù†ØªÙ‡ÙŠ' : 'â³ Ø¬Ø§Ø±ÙŠ'}
                    </span>
                  </div>
                  
                  <div style="color: #475569; font-weight: 600; margin-bottom: 12px; min-height: 40px;">
                    ${escapeHtml(t.subject)}
                  </div>
                  
                  <div style="font-size: 0.8rem; color: #64748b; display: flex; flex-direction: column; gap: 4px;">
                    <div><strong>ğŸ“¥ Ù…Ù†:</strong> ${escapeHtml(t.source || t.entity)}</div>
                    <div><strong>ğŸ“ Ø§Ù„ØªÙ†ÙÙŠØ°:</strong> ${escapeHtml(t.executionLocation || t.entity)}</div>
                    <div><strong>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${escapeHtml(t.date)}</div>
                    ${t.attachment ? `<div><a href="${escapeHtml(t.attachment)}" target="_blank" rel="noopener noreferrer" style="color: #0f766e; text-decoration: underline;">ğŸ“ Ø§Ù„Ù…Ø±ÙÙ‚</a></div>` : ''}
                    ${t.report ? `<div><a href="${escapeHtml(t.report)}" target="_blank" rel="noopener noreferrer" style="color: #dc2626; text-decoration: underline;">ğŸ“„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</a></div>` : ''}
                  </div>
                </div>
              `;
            }).join('')}
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
      lucide.createIcons();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 6. AUTO-LOAD ON PAGE READY (Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹ - Default)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    loadData();
  </script>
</body>
</html>
