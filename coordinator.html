<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© | Ø§Ù„Ù…Ù†Ø³Ù‚</title>
    
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; padding-bottom: 80px; }
        
        /* --- Header --- */
        .header-bg {
            background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
            padding: 1.5rem 1.5rem 2rem; /* Reduced padding since stats moved down */
            color: white;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            position: relative; z-index: 10;
            box-shadow: 0 4px 15px rgba(15, 118, 110, 0.2);
            margin-bottom: 1.5rem;
        }

        /* --- Filters (The Controller) --- */
        .filters-section {
            padding: 0 1rem; margin-bottom: 1.5rem;
        }
        .filters-box {
            background: white; border-radius: 16px; padding: 1.25rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #e2e8f0;
        }
        .filter-label { font-size: 0.7rem; font-weight: 700; color: #64748b; margin-bottom: 4px; display: block; }
        .filter-input {
            width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 10px;
            font-size: 0.8rem; outline: none; background-color: #f8fafc; transition: 0.2s;
        }
        .filter-input:focus { border-color: #0f766e; background: white; }

        /* --- Clickable Stats Bar --- */
        .stats-section {
            padding: 0 1rem; margin-bottom: 1.5rem;
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;
        }
        .stats-section::-webkit-scrollbar { height: 4px; }
        .stats-section::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        .stat-btn {
            min-width: 100px; flex: 1;
            background: white; border-radius: 14px; padding: 10px;
            border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .stat-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .stat-btn.active { border-color: #0f766e; background-color: #f0fdfa; ring: 2px solid #0f766e; }
        
        .stat-num { font-size: 1.4rem; font-weight: 800; line-height: 1; margin-bottom: 4px; }
        .stat-lbl { font-size: 0.65rem; font-weight: 700; color: #64748b; }

        /* Color Themes for Stats */
        .theme-total .stat-num { color: #0f766e; }
        .theme-late .stat-num { color: #dc2626; }
        .theme-new .stat-num { color: #475569; }
        .theme-pending .stat-num { color: #0284c7; } /* Blue */
        .theme-approved .stat-num { color: #15803d; } /* Dark Green */
        .theme-followup .stat-num { color: #ea580c; } /* Orange/White logic later */

        /* --- Task Cards (Colored Backgrounds) --- */
        .tasks-section { padding: 0 1rem 5rem; }
        
        .task-card {
            border-radius: 16px; border: 1px solid transparent;
            padding: 1rem; margin-bottom: 1rem; position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: all 0.2s;
            background: white; /* Default fallback */
        }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }

        /* Card Status Themes */
        .card-new { background: #ffffff; border-color: #e2e8f0; border-right: 4px solid #94a3b8; }
        .card-pending { background: #f0f9ff; border-color: #bae6fd; border-right: 4px solid #0ea5e9; } /* Light Blue */
        .card-approved { background: #f0fdf4; border-color: #bbf7d0; border-right: 4px solid #16a34a; } /* Light Green */
        .card-followup { background: #fff7ed; border-color: #ffedd5; border-right: 4px solid #f97316; } /* Light Orange */
        .card-late { background: #fef2f2; border-color: #fecaca; border-right: 4px solid #dc2626; } /* Light Red */

        /* Card Typography */
        .t-subject { font-size: 0.9rem; font-weight: 700; color: #1e293b; margin-bottom: 8px; line-height: 1.4; }
        .t-meta { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #475569; margin-bottom: 4px; }
        .t-meta i { width: 14px; height: 14px; opacity: 0.7; }
        .t-badge { 
            font-size: 0.65rem; padding: 2px 8px; border-radius: 6px; font-weight: 700; 
            background: white; border: 1px solid rgba(0,0,0,0.1); display: inline-block;
        }

        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #e2e8f0; padding: 10px; z-index: 50; display: flex; justify-content: space-around; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #94a3b8; gap: 4px; text-decoration: none; }
        .nav-item.active { color: #0f766e; font-weight: bold; }

        @media (min-width: 1024px) {
            .sidebar { position: fixed; right: 0; top: 0; height: 100vh; width: 260px; background: white; border-left: 1px solid #e2e8f0; padding: 1.5rem; display: flex; flex-direction: column; }
            .main-content { margin-right: 260px; padding: 20px; }
            .mobile-header, .bottom-nav { display: none; }
            .header-bg { display: none; }
            #tasks-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem; }
        }
    </style>
</head>
<body>

    <aside class="sidebar hidden lg:flex">
        <div class="flex items-center gap-3 mb-8 px-2">
            <img src="assets/icons/favicon.png" class="w-10 h-10">
            <div><h1 class="font-bold text-slate-800">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h1><p class="text-xs text-slate-500">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø³Ù‚</p></div>
        </div>
        <nav class="flex-1 space-y-2">
            <a href="index.html" class="flex items-center gap-3 p-3 text-slate-500 hover:bg-teal-50 hover:text-teal-700 rounded-lg font-bold"><i data-lucide="home" class="w-5 h-5"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="distribution.html" class="flex items-center gap-3 p-3 text-slate-500 hover:bg-teal-50 hover:text-teal-700 rounded-lg font-bold"><i data-lucide="bar-chart-2" class="w-5 h-5"></i> Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a>
            <a href="coordinator.html" class="flex items-center gap-3 p-3 bg-teal-600 text-white rounded-lg font-bold shadow-md"><i data-lucide="users" class="w-5 h-5"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</a>
            <a href="forms.html" class="flex items-center gap-3 p-3 text-slate-500 hover:bg-teal-50 hover:text-teal-700 rounded-lg font-bold"><i data-lucide="file-text" class="w-5 h-5"></i> Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
        </nav>
        <button onclick="auth.logout()" class="text-red-500 font-bold flex items-center gap-2 mt-auto p-2"><i data-lucide="log-out" class="w-5 h-5"></i> Ø®Ø±ÙˆØ¬</button>
    </aside>

    <div class="main-content">
        <div class="header-bg lg:hidden">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm">
                        <img src="assets/icons/favicon.png" class="w-6 h-6 object-contain">
                    </div>
                    <div>
                        <p class="text-teal-100 text-[10px]">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
                        <h1 class="font-bold text-lg text-white" id="user-name">...</h1>
                    </div>
                </div>
                <button onclick="auth.logout()" class="bg-white/20 p-2 rounded-xl text-white"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
        </div>

        <div class="filters-section">
            <div class="filters-box">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-slate-800 text-sm flex items-center gap-2">
                        <i data-lucide="filter" class="w-4 h-4 text-[#0f766e]"></i> ØªØµÙÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </h3>
                    <button onclick="resetFilters()" class="text-[10px] bg-red-50 text-red-600 px-2 py-1 rounded hover:bg-red-100 font-bold">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                    <div>
                        <label class="filter-label">Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                        <select id="f-emp" class="filter-input" onchange="applyFilters()">
                            <option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
                            <optgroup label="Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„">
                                <option value="group_admin">ğŸ‘¨â€ğŸ’¼ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
                                <option value="group_tech">ğŸ‘¨â€âš•ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ø·Ø¨ÙŠ</option>
                            </optgroup>
                            <optgroup label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡" id="emp-list-container">
                                </optgroup>
                        </select>
                    </div>

                    <div>
                        <label class="filter-label">Ø¨Ø­Ø« Ø´Ø§Ù…Ù„ (Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹)</label>
                        <input type="text" id="f-search" class="filter-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©..." oninput="applyFilters()">
                    </div>

                    <div class="flex gap-2">
                        <div class="flex-1">
                            <label class="filter-label">Ù…Ù†</label>
                            <input type="date" id="f-start" class="filter-input" onchange="applyFilters()">
                        </div>
                        <div class="flex-1">
                            <label class="filter-label">Ø¥Ù„Ù‰</label>
                            <input type="date" id="f-end" class="filter-input" onchange="applyFilters()">
                        </div>
                    </div>

                    <div>
                        <label class="filter-label">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶</label>
                        <select id="f-sort" class="filter-input" onchange="applyFilters()">
                            <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
                            <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
                            <option value="source">Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© (Ø£Ø¨Ø¬Ø¯ÙŠ)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-section" id="stats-bar">
            <div class="stat-btn theme-total active" onclick="setStatusFilter('')" id="btn-stat-total">
                <span class="stat-num" id="c-total">0</span>
                <span class="stat-lbl">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
            </div>
            <div class="stat-btn theme-late" onclick="setStatusFilter('Ù…ØªØ£Ø®Ø±')" id="btn-stat-late">
                <span class="stat-num" id="c-late">0</span>
                <span class="stat-lbl">Ù…ØªØ£Ø®Ø±</span>
            </div>
            <div class="stat-btn theme-new" onclick="setStatusFilter('Ø¬Ø¯ÙŠØ¯')" id="btn-stat-new">
                <span class="stat-num" id="c-new">0</span>
                <span class="stat-lbl">Ø¬Ø¯ÙŠØ¯</span>
            </div>
            <div class="stat-btn theme-pending" onclick="setStatusFilter('Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯')" id="btn-stat-pending">
                <span class="stat-num" id="c-pending">0</span>
                <span class="stat-lbl">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø¹ØªÙ…Ø§Ø¯</span>
            </div>
            <div class="stat-btn theme-approved" onclick="setStatusFilter('ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯')" id="btn-stat-approved">
                <span class="stat-num" id="c-approved">0</span>
                <span class="stat-lbl">ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</span>
            </div>
            <div class="stat-btn theme-followup" onclick="setStatusFilter('Ø¨Ø­Ø§Ø¬Ø© Ø§Ù„ÙŠ Ù…ØªØ§Ø¨Ø¹Ø©')" id="btn-stat-followup">
                <span class="stat-num" id="c-followup">0</span>
                <span class="stat-lbl">Ù…ØªØ§Ø¨Ø¹Ø©</span>
            </div>
        </div>

        <div class="tasks-section">
            <div id="tasks-container">
                <div class="text-center py-12"><span class="inline-block animate-spin text-[#0f766e]"><i data-lucide="loader-2" class="w-8 h-8"></i></span><p class="text-slate-400 text-xs mt-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><i data-lucide="home"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="distribution.html" class="nav-item"><i data-lucide="bar-chart-2"></i>Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a>
        <a href="coordinator.html" class="nav-item active"><i data-lucide="users"></i>Ø§Ù„ØªÙˆØ²ÙŠØ¹</a>
        <a href="forms.html" class="nav-item"><i data-lucide="file-text"></i>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
    </nav>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        lucide.createIcons();
        let allTasks = [];
        let activeEmployees = [];
        let currentStatusFilter = ''; // To track stats click

        // ØªØµÙ†ÙŠÙ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ù„ØºØ±Ø¶ Ø§Ù„ÙÙ„ØªØ±)
        const adminKeywords = ["Ø£.", "Ù…Ø­Ù…ÙˆØ¯", "Ø¥ÙŠÙ…Ø§Ù†", "Ø¹Ù„Ø§", "Ù†ÙŠÙÙŠÙ†", "Ù†Ø³Ù…Ø©", "Ø£Ø³Ù…Ø§Ø¡", "Ù…Ø§Ù„ÙŠ", "Ø¥Ø¯Ø§Ø±ÙŠ"];
        const techKeywords = ["Ø¯.", "ÙÙ†ÙŠ", "ØµÙŠØ¯Ù„ÙŠ", "Ø·Ø¨ÙŠØ¨", "ØªÙ…Ø±ÙŠØ¶"];

        document.addEventListener('DOMContentLoaded', async () => {
            const user = auth.checkAuth();
            if (!user) return;
            document.getElementById('user-name').textContent = user.name.split(' ')[0];

            // Set Date Filter to Current Month
            const date = new Date();
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).toISOString().split('T')[0];
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0).toISOString().split('T')[0];
            document.getElementById('f-start').value = firstDay;
            document.getElementById('f-end').value = lastDay;

            await loadEmployees();
            await loadTasks(user.name);
        });

        async function loadEmployees() {
            try {
                const API_URL = (typeof CONFIG !== 'undefined') ? CONFIG.API_URL : '';
                const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getEmployees' }) });
                const data = await res.json();
                if(data.success && data.data) {
                    activeEmployees = data.data;
                    const container = document.getElementById('emp-list-container');
                    activeEmployees.sort().forEach(emp => {
                        const opt = document.createElement('option');
                        opt.value = emp;
                        opt.textContent = emp;
                        container.appendChild(opt);
                    });
                }
            } catch(e) {}
        }

        async function loadTasks(username) {
            try {
                const API_URL = (typeof CONFIG !== 'undefined') ? CONFIG.API_URL : '';
                // Requesting 'Admin' role data to get everything
                const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getAllData', role: 'Ù…Ø¯ÙŠØ±', name: username }) });
                const data = await res.json();

                if (data.success) {
                    allTasks = data.tasks || [];
                    updateStatsCounts();
                    applyFilters(); 
                } else {
                    document.getElementById('tasks-container').innerHTML = `<div class="text-center py-10 text-red-500 text-xs">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>`;
                }
            } catch (e) {
                console.error(e);
                document.getElementById('tasks-container').innerHTML = `<div class="text-center py-10 text-red-500 text-xs">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>`;
            }
        }

        // --- Functions ---

        function setStatusFilter(status) {
            currentStatusFilter = status;
            
            // UI Update for Buttons
            document.querySelectorAll('.stat-btn').forEach(btn => btn.classList.remove('active'));
            if(status === '') document.getElementById('btn-stat-total').classList.add('active');
            else if(status === 'Ù…ØªØ£Ø®Ø±') document.getElementById('btn-stat-late').classList.add('active');
            else if(status === 'Ø¬Ø¯ÙŠØ¯') document.getElementById('btn-stat-new').classList.add('active');
            else if(status === 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯') document.getElementById('btn-stat-pending').classList.add('active');
            else if(status === 'ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯') document.getElementById('btn-stat-approved').classList.add('active');
            else if(status === 'Ø¨Ø­Ø§Ø¬Ø© Ø§Ù„ÙŠ Ù…ØªØ§Ø¨Ø¹Ø©') document.getElementById('btn-stat-followup').classList.add('active');

            applyFilters();
        }

        function updateStatsCounts() {
            let s = { total: 0, new: 0, pending: 0, approved: 0, followup: 0, late: 0 };
            allTasks.forEach(t => {
                s.total++;
                const status = (t.status || '').trim();
                if (status.includes('Ø¬Ø¯ÙŠØ¯')) s.new++;
                else if (status.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')) s.pending++;
                else if (status.includes('ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯')) s.approved++;
                else if (status.includes('Ù…ØªØ§Ø¨Ø¹Ø©')) s.followup++;
                else if (status.includes('Ù…ØªØ£Ø®Ø±')) s.late++;
            });

            document.getElementById('c-total').innerText = s.total;
            document.getElementById('c-new').innerText = s.new;
            document.getElementById('c-pending').innerText = s.pending;
            document.getElementById('c-approved').innerText = s.approved;
            document.getElementById('c-followup').innerText = s.followup;
            document.getElementById('c-late').innerText = s.late;
        }

        function applyFilters() {
            const empVal = document.getElementById('f-emp').value;
            const searchVal = document.getElementById('f-search').value.toLowerCase();
            const startVal = document.getElementById('f-start').value;
            const endVal = document.getElementById('f-end').value;
            const sortVal = document.getElementById('f-sort').value;

            const filtered = allTasks.filter(t => {
                // 1. Status Filter (from Stats Bar)
                if (currentStatusFilter && !(t.status || '').includes(currentStatusFilter)) return false;

                // 2. Employee Group Logic
                if (empVal) {
                    if (empVal === 'group_admin') {
                        // Check if name contains admin keywords
                        const isAdm = adminKeywords.some(k => (t.assignee || '').includes(k));
                        if (!isAdm) return false;
                    } else if (empVal === 'group_tech') {
                        // Check if name contains tech keywords
                        const isTech = techKeywords.some(k => (t.assignee || '').includes(k));
                        if (!isTech) return false;
                    } else {
                        // Exact match
                        if (t.assignee !== empVal) return false;
                    }
                }

                // 3. Search (Source, Subject, ID)
                if (searchVal && !(
                    (t.source || '').toLowerCase().includes(searchVal) || 
                    (t.subject || '').toLowerCase().includes(searchVal) || 
                    (String(t.id)).includes(searchVal)
                )) return false;

                // 4. Date Range
                if (startVal || endVal) {
                    // Convert API date (DD/MM/YYYY) to YYYY-MM-DD
                    const parts = (t.date || '').split('/');
                    if (parts.length === 3) {
                        const isoDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
                        if (startVal && isoDate < startVal) return false;
                        if (endVal && isoDate > endVal) return false;
                    }
                }

                return true;
            });

            // Sorting
            filtered.sort((a, b) => {
                if (sortVal === 'newest') return b.id - a.id;
                if (sortVal === 'oldest') return a.id - b.id;
                if (sortVal === 'source') return (a.source || '').localeCompare(b.source || '');
                return 0;
            });

            renderTasks(filtered);
        }

        function renderTasks(tasks) {
            const container = document.getElementById('tasks-container');
            if (tasks.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-12 opacity-50"><i data-lucide="search-x" class="w-12 h-12 mx-auto mb-2 text-slate-300"></i><p class="text-xs text-slate-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</p></div>`;
                lucide.createIcons();
                return;
            }

            container.innerHTML = tasks.map(t => {
                const s = (t.status || '').trim();
                let cardClass = 'card-new';
                let stLabel = s || 'Ø¬Ø¯ÙŠØ¯';

                if (s.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')) { cardClass = 'card-pending'; }
                else if (s.includes('ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯')) { cardClass = 'card-approved'; }
                else if (s.includes('Ù…ØªØ§Ø¨Ø¹Ø©')) { cardClass = 'card-followup'; }
                else if (s.includes('Ù…ØªØ£Ø®Ø±')) { cardClass = 'card-late'; }

                return `
                <div class="task-card ${cardClass}">
                    <div class="card-header">
                        <span class="t-badge shadow-sm">${stLabel}</span>
                        <div class="date-badge">
                            <i data-lucide="calendar" class="w-3 h-3"></i> ${t.date || '-'}
                            <span class="text-slate-300 mx-1">|</span> # ${t.id}
                        </div>
                    </div>

                    <h3 class="t-subject">${t.subject}</h3>
                    
                    <div class="mb-3">
                        <div class="t-meta"><i data-lucide="building-2"></i> <strong>Ø§Ù„Ø¬Ù‡Ø©:</strong> ${t.source || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        <div class="t-meta"><i data-lucide="user"></i> <strong>Ø§Ù„Ù…ÙƒÙ„Ù:</strong> ${t.assignee || '<span class="text-red-400">ØºÙŠØ± Ù…ÙˆØ²Ø¹</span>'}</div>
                    </div>
                </div>`;
            }).join('');
            
            lucide.createIcons();
        }

        function resetFilters() {
            document.getElementById('f-emp').value = '';
            document.getElementById('f-search').value = '';
            document.getElementById('f-start').value = '';
            document.getElementById('f-end').value = '';
            setStatusFilter(''); // Reset stats
        }
    </script>
</body>
</html>
