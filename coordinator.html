<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… | Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</title>
    
    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; padding-bottom: 80px; }
        
        /* Custom Colors & Shadows */
        .header-bg {
            background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
            box-shadow: 0 4px 20px rgba(15, 118, 110, 0.2);
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 12px 24px; border-radius: 12px; font-weight: 700; font-size: 0.9rem;
            display: flex; align-items: center; gap: 8px; z-index: 9999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            animation: slideDown 0.3s ease forwards;
            opacity: 0;
        }
        @keyframes slideDown { from { top: -20px; opacity: 0; } to { top: 20px; opacity: 1; } }
        .toast-success { background: #065f46; color: white; border: 1px solid #34d399; }
        .toast-error { background: #991b1b; color: white; border: 1px solid #fca5a5; }

        /* Reassign Styles */
        .assign-select {
            padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 8px;
            font-size: 0.8rem; outline: none; background: white; width: 100%; transition: 0.2s;
        }
        .assign-select:focus { border-color: #0f766e; box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.1); }
        
        .btn-save {
            background: #0f766e; color: white; padding: 6px 12px; border-radius: 8px;
            font-size: 0.75rem; font-weight: 700; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 4px;
        }
        .btn-save:hover { background: #115e59; }
        .btn-save:disabled { opacity: 0.7; cursor: not-allowed; }

        /* Mobile Card Style */
        .task-card {
            background: white; border-radius: 16px; border: 1px solid #e2e8f0;
            padding: 1.25rem; margin-bottom: 1rem; position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        
        /* Status Badges */
        .badge { padding: 4px 10px; border-radius: 99px; font-size: 0.65rem; font-weight: 700; }
        .badge-new { background: #f1f5f9; color: #475569; }
        .badge-pending { background: #fef3c7; color: #b45309; }
        .badge-done { background: #dcfce7; color: #15803d; }
        .badge-late { background: #fee2e2; color: #991b1b; }

        /* Sidebar Desktop */
        @media (min-width: 1024px) {
            body { padding-right: 260px; padding-bottom: 0; }
            .mobile-header { display: none; }
            .bottom-nav { display: none; }
        }
        .sidebar {
            position: fixed; right: 0; top: 0; height: 100vh; width: 260px;
            background: white; border-left: 1px solid #e2e8f0; z-index: 50;
            display: none; flex-direction: column;
        }
        @media (min-width: 1024px) { .sidebar { display: flex; } }
        
        .nav-item {
            display: flex; align-items: center; gap: 10px; padding: 12px 20px;
            color: #64748b; font-weight: 600; text-decoration: none; transition: 0.2s; margin-bottom: 4px;
        }
        .nav-item:hover { background: #f0fdfa; color: #0f766e; }
        .nav-item.active { background: linear-gradient(135deg, #0f766e, #115e59); color: white; border-radius: 8px; }
    </style>
</head>
<body>

    <aside class="sidebar p-4">
        <div class="flex items-center gap-3 px-2 mb-8">
            <div class="w-10 h-10 bg-teal-50 rounded-full flex items-center justify-center">
                <img src="assets/icons/favicon.png" class="w-6 h-6 object-contain">
            </div>
            <div>
                <h1 class="font-bold text-slate-800 text-lg">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</h1>
                <p class="text-[10px] text-slate-500">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø³Ù‚</p>
            </div>
        </div>
        <nav class="flex-1">
            <a href="index.html" class="nav-item rounded-lg"><i data-lucide="home" class="w-5 h-5"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="distribution.html" class="nav-item rounded-lg"><i data-lucide="bar-chart-2" class="w-5 h-5"></i> Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</a>
            <a href="coordinator.html" class="nav-item active rounded-lg"><i data-lucide="users" class="w-5 h-5"></i> Ø§Ù„Ù…Ù†Ø³Ù‚ÙŠÙ†</a>
            <a href="forms.html" class="nav-item rounded-lg"><i data-lucide="file-text" class="w-5 h-5"></i> Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</a>
        </nav>
        <div class="mt-auto border-t border-slate-100 pt-4">
            <div class="px-2 mb-2">
                <p class="text-xs text-slate-400 font-bold">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                <p class="text-sm font-bold text-slate-800 truncate" id="sidebar-user">...</p>
            </div>
            <button onclick="logout()" class="nav-item w-full text-red-500 hover:bg-red-50 hover:text-red-600 rounded-lg">
                <i data-lucide="log-out" class="w-5 h-5"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </aside>

    <div class="header-bg lg:hidden p-4 pb-16 text-white rounded-b-[30px] mb-[-30px] relative z-10">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-white/20 p-2 rounded-full backdrop-blur-sm">
                    <img src="assets/icons/favicon.png" class="w-6 h-6 object-contain">
                </div>
                <div>
                    <p class="text-teal-100 text-xs font-bold">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø³Ù‚</p>
                    <h1 class="font-bold text-lg" id="mobile-user">...</h1>
                </div>
            </div>
            <button onclick="logout()" class="bg-white/20 p-2 rounded-xl hover:bg-red-500/50 transition">
                <i data-lucide="log-out" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <main class="container mx-auto px-4 lg:py-8 pt-12 pb-24">
        
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6 relative z-20">
            <div class="bg-white p-4 rounded-xl border border-blue-100 shadow-sm text-center">
                <p class="text-xs text-slate-500 font-bold mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                <h3 class="text-2xl font-black text-blue-600" id="s-total">0</h3>
            </div>
            <div class="bg-white p-4 rounded-xl border border-yellow-100 shadow-sm text-center">
                <p class="text-xs text-slate-500 font-bold mb-1">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                <h3 class="text-2xl font-black text-yellow-600" id="s-pending">0</h3>
            </div>
            <div class="bg-white p-4 rounded-xl border border-green-100 shadow-sm text-center">
                <p class="text-xs text-slate-500 font-bold mb-1">Ù…ÙƒØªÙ…Ù„Ø©</p>
                <h3 class="text-2xl font-black text-green-600" id="s-completed">0</h3>
            </div>
            <div class="bg-white p-4 rounded-xl border border-red-100 shadow-sm text-center">
                <p class="text-xs text-slate-500 font-bold mb-1">Ù…ØªØ£Ø®Ø±Ø©</p>
                <h3 class="text-2xl font-black text-red-600" id="s-late">0</h3>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-slate-700 text-sm">ØªØµÙÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
                <button onclick="resetFilters()" class="text-xs text-red-500 font-bold hover:underline">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <input type="text" id="f-search" placeholder="Ø¨Ø­Ø« (Ø±Ù‚Ù…ØŒ Ø¬Ù‡Ø©ØŒ Ù…ÙˆØ¶ÙˆØ¹)..." class="assign-select">
                <select id="f-emp" class="assign-select"><option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option></select>
                <select id="f-status" class="assign-select">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                    <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                    <option value="Ù…ÙƒØªÙ…Ù„Ø©">Ù…ÙƒØªÙ…Ù„Ø©</option>
                    <option value="Ù…ØªØ£Ø®Ø±Ø©">Ù…ØªØ£Ø®Ø±Ø©</option>
                </select>
                <button onclick="applyFilters()" class="bg-[#0f766e] text-white rounded-lg py-2 text-sm font-bold hover:bg-[#0d5f57] shadow-md transition">
                    ØªÙ†ÙÙŠØ° Ø§Ù„ÙÙ„ØªØ±
                </button>
            </div>
        </div>

        <div id="content-area">
            <div id="loading" class="text-center py-12">
                <span class="inline-block animate-spin text-[#0f766e]"><i data-lucide="loader-2" class="w-8 h-8"></i></span>
                <p class="text-sm text-slate-400 mt-2">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>

            <div id="table-view" class="hidden lg:block bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-sm text-right">
                    <thead class="bg-slate-50 text-slate-500 font-bold border-b border-slate-200">
                        <tr>
                            <th class="p-4">#</th>
                            <th class="p-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th class="p-4">Ø§Ù„Ø¬Ù‡Ø©</th>
                            <th class="p-4 w-1/3">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                            <th class="p-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="p-4 w-1/4">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>

            <div id="cards-view" class="lg:hidden space-y-4"></div>
        </div>

    </main>

    <nav class="bottom-nav lg:hidden fixed bottom-0 w-full bg-white border-t border-slate-200 flex justify-around py-2 z-50">
        <a href="index.html" class="flex flex-col items-center text-[10px] text-slate-400 gap-1 p-2">
            <i data-lucide="home" class="w-5 h-5"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
        <a href="distribution.html" class="flex flex-col items-center text-[10px] text-slate-400 gap-1 p-2">
            <i data-lucide="bar-chart-2" class="w-5 h-5"></i> Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
        </a>
        <a href="coordinator.html" class="flex flex-col items-center text-[10px] text-[#0f766e] font-bold gap-1 p-2">
            <i data-lucide="users" class="w-5 h-5"></i> Ø§Ù„Ù…Ù†Ø³Ù‚ÙŠÙ†
        </a>
        <a href="forms.html" class="flex flex-col items-center text-[10px] text-slate-400 gap-1 p-2">
            <i data-lucide="file-text" class="w-5 h-5"></i> Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        </a>
    </nav>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        // Initialization
        lucide.createIcons();
        let allTasks = [];
        let staffList = [];

        document.addEventListener('DOMContentLoaded', async () => {
            const user = auth.checkAuth();
            if (!user) return; // auth.js handles redirect

            document.getElementById('mobile-user').textContent = user.name;
            document.getElementById('sidebar-user').textContent = user.name;

            await loadEmployees(); // Load employees first
            await loadData(user.name);
        });

        // 1. Fetch Employees (Dynamic)
        async function loadEmployees() {
            try {
                const API_URL = (typeof CONFIG !== 'undefined') ? CONFIG.API_URL : '';
                if (!API_URL) return;

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getEmployees' })
                });
                const data = await response.json();
                
                if (data.success) {
                    staffList = data.data; // Store dynamically
                    // Populate Filters
                    const empSelect = document.getElementById('f-emp');
                    empSelect.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>';
                    staffList.forEach(emp => {
                        empSelect.innerHTML += `<option value="${emp}">${emp}</option>`;
                    });
                }
            } catch (e) {
                console.error("Failed to load employees", e);
                // Fallback list just in case
                staffList = ["Ø¯. Ù…ØµØ·ÙÙ‰ Ø­Ù…Ø²Ø©", "Ø¯. Ø±ÙŠÙ‡Ø§Ù… Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø£. Ø¹Ù…Ø±Ùˆ Ø±Ø´Ø§Ø¯", "Ø£. Ù…Ø­Ù…ÙˆØ¯ Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†"];
            }
        }

        // 2. Load Tasks (The Fix is HERE)
        async function loadData(username) {
            try {
                const API_URL = (typeof CONFIG !== 'undefined') ? CONFIG.API_URL : 'https://script.google.com/macros/s/AKfycbzB0a7A7Dq4j5-l_-4YkBH1c-cOmgi7kIFP6Da8ZjM1CLfz9xZIncim13cJfc2LPyru3A/exec';
                
                // ğŸ”¥ Ù‡Ø§Ù…: Ù†Ø±Ø³Ù„ role: 'Ù…Ø¯ÙŠØ±' Ù‡Ù†Ø§ Ø®Ø¯Ø§Ø¹Ø§Ù‹ Ù„Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ù„ÙƒÙŠ ÙŠØ±Ø³Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ù†Ø³Ù‚ ğŸ”¥
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        action: 'getAllData',
                        role: 'Ù…Ø¯ÙŠØ±', // Trick backend to send all data
                        name: username 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    allTasks = data.tasks || [];
                    calculateStats();
                    applyFilters();
                } else {
                    throw new Error(data.error || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            } catch (error) {
                console.error(error);
                document.getElementById('loading').innerHTML = `<p class="text-red-500 font-bold">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª (${error.message})</p>`;
            }
        }

        // Stats Calculation
        function calculateStats() {
            const total = allTasks.length;
            const pending = allTasks.filter(t => (t.status || '').includes('ØªÙ†ÙÙŠØ°') || (t.status || '').includes('Ø¬Ø¯ÙŠØ¯') || (t.status || '').includes('Ø¬Ø§Ø±ÙŠ')).length;
            const completed = allTasks.filter(t => (t.status || '').includes('Ù…ÙƒØªÙ…Ù„') || (t.status || '').includes('ØªÙ…')).length;
            const late = allTasks.filter(t => (t.status || '').includes('Ù…ØªØ£Ø®Ø±')).length;

            document.getElementById('s-total').innerText = total;
            document.getElementById('s-pending').innerText = pending;
            document.getElementById('s-completed').innerText = completed;
            document.getElementById('s-late').innerText = late;
        }

        // Filters & Render
        function applyFilters() {
            const search = document.getElementById('f-search').value.toLowerCase();
            const emp = document.getElementById('f-emp').value;
            const status = document.getElementById('f-status').value;

            const filtered = allTasks.filter(t => {
                const matchSearch = (String(t.id) + t.subject + t.source).toLowerCase().includes(search);
                const matchEmp = emp === "" || t.assignee === emp;
                const matchStatus = status === "" || (t.status || '').includes(status);
                return matchSearch && matchEmp && matchStatus;
            });

            renderContent(filtered);
        }

        function renderContent(tasks) {
            const loading = document.getElementById('loading');
            const tableView = document.getElementById('table-view');
            const cardsView = document.getElementById('cards-view');
            const tbody = document.getElementById('table-body');

            loading.classList.add('hidden');
            
            if (tasks.length === 0) {
                tableView.classList.add('hidden');
                cardsView.innerHTML = `<div class="text-center py-10 text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø·Ø§Ø¨Ù‚Ø©</div>`;
                return;
            }

            tableView.classList.remove('hidden');
            tbody.innerHTML = '';
            cardsView.innerHTML = '';

            // Generate Dropdown Options
            let optionsHTML = '<option value="">-- Ø§Ø®ØªØ± --</option>';
            staffList.forEach(emp => {
                optionsHTML += `<option value="${emp}">${emp}</option>`;
            });

            tasks.forEach(t => {
                let badgeClass = 'badge-new';
                const s = t.status || '';
                if (s.includes('ØªÙ†ÙÙŠØ°') || s.includes('Ø¬Ø§Ø±ÙŠ')) badgeClass = 'badge-pending';
                if (s.includes('Ù…ÙƒØªÙ…Ù„') || s.includes('ØªÙ…')) badgeClass = 'badge-done';
                if (s.includes('Ù…ØªØ£Ø®Ø±')) badgeClass = 'badge-late';

                const statusHTML = `<span class="badge ${badgeClass}">${s}</span>`;
                const dateShort = t.date ? t.date.split('T')[0] : '-';
                
                // Select active employee
                const rowOptions = optionsHTML.replace(`value="${t.assignee}"`, `value="${t.assignee}" selected`);

                // --- Desktop Row ---
                tbody.innerHTML += `
                <tr class="hover:bg-slate-50 transition border-b border-slate-50">
                    <td class="p-4 font-mono text-xs text-slate-500">#${t.id}</td>
                    <td class="p-4 text-slate-600">${dateShort}</td>
                    <td class="p-4 font-bold text-slate-700 text-xs">${t.source || t.entity}</td>
                    <td class="p-4 text-slate-600 truncate max-w-xs text-xs" title="${t.subject}">${t.subject}</td>
                    <td class="p-4">${statusHTML}</td>
                    <td class="p-4">
                        <div class="flex gap-2 items-center">
                            <select id="desk-sel-${t.id}" class="assign-select py-1">
                                ${rowOptions}
                            </select>
                            <button onclick="reassign('${t.id}', 'desk-sel-${t.id}')" class="bg-teal-50 text-teal-700 p-1.5 rounded hover:bg-teal-100 transition">
                                <i data-lucide="save" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;

                // --- Mobile Card ---
                cardsView.innerHTML += `
                <div class="task-card">
                    <div class="flex justify-between items-start mb-3">
                        ${statusHTML}
                        <span class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-500">#${t.id}</span>
                    </div>
                    <h3 class="font-bold text-slate-800 text-sm mb-2 leading-relaxed">${t.subject}</h3>
                    <div class="flex items-center gap-2 text-xs text-slate-500 mb-4">
                        <i data-lucide="building-2" class="w-3 h-3 text-slate-400"></i>
                        <span>${t.source || t.entity}</span>
                    </div>
                    
                    <div class="bg-slate-50 p-3 rounded-xl border border-slate-100">
                        <label class="text-[10px] font-bold text-slate-400 block mb-1">ØªÙˆØ²ÙŠØ¹ Ø¥Ù„Ù‰:</label>
                        <div class="flex gap-2">
                            <select id="mob-sel-${t.id}" class="assign-select">
                                ${rowOptions}
                            </select>
                            <button onclick="reassign('${t.id}', 'mob-sel-${t.id}')" class="btn-save w-10">
                                <i data-lucide="check" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>`;
            });

            lucide.createIcons();
        }

        // Reassign Action
        async function reassign(taskId, selectId) {
            const select = document.getElementById(selectId);
            const newEmp = select.value;
            const btn = select.nextElementSibling;
            const originalIcon = btn.innerHTML;

            if (!newEmp) return showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù", "error");

            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`;
            lucide.createIcons();

            try {
                const API_URL = (typeof CONFIG !== 'undefined') ? CONFIG.API_URL : '';
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'reassignTask',
                        taskId: taskId,
                        newEmployee: newEmp
                    })
                });
                
                const result = await response.json();

                if (result.success) {
                    showToast(`ØªÙ… Ø§Ù„ØªÙƒÙ„ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù€ ${newEmp}`, "success");
                    // Update Local
                    const taskIndex = allTasks.findIndex(t => t.id == taskId);
                    if (taskIndex > -1) allTasks[taskIndex].assignee = newEmp;
                    
                    btn.innerHTML = `<i data-lucide="check-circle" class="w-4 h-4"></i>`;
                    setTimeout(() => { 
                        btn.innerHTML = originalIcon; 
                        btn.disabled = false; 
                    }, 2000);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                showToast("ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + error.message, "error");
                btn.innerHTML = originalIcon;
                btn.disabled = false;
            }
        }

        function showToast(msg, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'success' ? 'toast-success' : 'toast-error'}`;
            toast.innerHTML = type === 'success' ? 
                `<i data-lucide="check-circle" class="w-4 h-4"></i> ${msg}` : 
                `<i data-lucide="alert-circle" class="w-4 h-4"></i> ${msg}`;
            document.body.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.remove(), 3000);
        }

        function resetFilters() {
            document.getElementById('f-search').value = '';
            document.getElementById('f-emp').value = '';
            document.getElementById('f-status').value = '';
            applyFilters();
        }

        function logout() {
            auth.logout();
        }
    </script>
</body>
</html>
